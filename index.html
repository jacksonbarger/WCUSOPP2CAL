<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="P2 Calendar">
    <meta name="theme-color" content="#0F172A">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="apple-touch-icon" href="icon.svg">
    <link rel="manifest" href="manifest.json">
    <title>WCU SOP P2 Calendar - Spring 2026</title>
    <!-- Vercel Analytics -->
    <script>
      window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Theme: Midnight Indigo (Dark - Default)
           Navy-slate backgrounds with indigo/cyan accents
           WCAG AAA: 15.8:1 contrast ratio */
        :root {
            --color-primary: #818CF8;
            --color-primary-light: #A5B4FC;
            --color-primary-dark: #6366F1;
            --color-accent: #22D3EE;
            --color-accent-light: #67E8F9;
            --color-background: #0F172A;
            --color-background-light: #1E293B;
            --color-background-card: #334155;
            --color-text-primary: #F8FAFC;
            --color-text-secondary: #E2E8F0;
            --color-text-muted: #94A3B8;
            --color-border: rgba(129, 140, 248, 0.25);
            --color-glow: rgba(34, 211, 238, 0.35);
            /* CVD-safe block colors for dark themes */
            --block-neuro1: #F59E0B;
            --block-neuro2: #60A5FA;
            --block-psych: #3B82F6;
            --block-derm: #FCD34D;
            --block-special: #34D399;
            --block-exam: #F97316;
            --block-lab: #E879F9;
            --block-law: #94A3B8;
        }

        /* Theme: Ocean Depths (Dark)
           Teal/ocean with warm amber accents - Wong/Okabe-Ito inspired
           WCAG AAA: 16.2:1 contrast ratio */
        [data-theme="ocean"] {
            --color-primary: #14B8A6;
            --color-primary-light: #2DD4BF;
            --color-primary-dark: #0D9488;
            --color-accent: #F59E0B;
            --color-accent-light: #FBBF24;
            --color-background: #0C1929;
            --color-background-light: #162033;
            --color-background-card: #1E3A5F;
            --color-text-primary: #F0F9FF;
            --color-text-secondary: #E0F2FE;
            --color-text-muted: #7DD3FC;
            --color-border: rgba(20, 184, 166, 0.3);
            --color-glow: rgba(245, 158, 11, 0.35);
            /* Wong/Okabe-Ito CVD-safe palette */
            --block-neuro1: #E69F00;
            --block-neuro2: #56B4E9;
            --block-psych: #0072B2;
            --block-derm: #F0E442;
            --block-special: #009E73;
            --block-exam: #D55E00;
            --block-lab: #CC79A7;
            --block-law: #94A3B8;
        }

        /* Theme: Cream & Coffee (Light)
           Warm cream backgrounds with violet primary, amber accents
           WCAG AAA: 18.2:1 contrast ratio */
        [data-theme="cream"] {
            --color-primary: #7C3AED;
            --color-primary-light: #8B5CF6;
            --color-primary-dark: #6D28D9;
            --color-accent: #D97706;
            --color-accent-light: #F59E0B;
            --color-background: #FFFBEB;
            --color-background-light: #FEF3C7;
            --color-background-card: #FFFFFF;
            --color-text-primary: #1C1917;
            --color-text-secondary: #44403C;
            --color-text-muted: #78716C;
            --color-border: rgba(124, 58, 237, 0.2);
            --color-glow: rgba(217, 119, 6, 0.25);
            /* Darker block colors for light backgrounds */
            --block-neuro1: #D97706;
            --block-neuro2: #2563EB;
            --block-psych: #1D4ED8;
            --block-derm: #CA8A04;
            --block-special: #059669;
            --block-exam: #EA580C;
            --block-lab: #C026D3;
            --block-law: #475569;
        }

        /* Theme: Arctic Frost (Light)
           Cool gray-blue backgrounds with blue/rose accents
           WCAG AAA: 15.8:1 contrast ratio */
        [data-theme="arctic"] {
            --color-primary: #2563EB;
            --color-primary-light: #3B82F6;
            --color-primary-dark: #1D4ED8;
            --color-accent: #E11D48;
            --color-accent-light: #F43F5E;
            --color-background: #F8FAFC;
            --color-background-light: #F1F5F9;
            --color-background-card: #FFFFFF;
            --color-text-primary: #0F172A;
            --color-text-secondary: #334155;
            --color-text-muted: #64748B;
            --color-border: rgba(37, 99, 235, 0.15);
            --color-glow: rgba(225, 29, 72, 0.15);
            /* Darker block colors for light backgrounds */
            --block-neuro1: #D97706;
            --block-neuro2: #2563EB;
            --block-psych: #0284C7;
            --block-derm: #CA8A04;
            --block-special: #059669;
            --block-exam: #EA580C;
            --block-lab: #C026D3;
            --block-law: #475569;
        }

        /* Theme: Rose Garden (Light)
           Soft pink/rose backgrounds with magenta/coral accents
           WCAG AAA: 16+ contrast ratio */
        [data-theme="rose"] {
            --color-primary: #EC4899;
            --color-primary-light: #F472B6;
            --color-primary-dark: #DB2777;
            --color-accent: #F97316;
            --color-accent-light: #FB923C;
            --color-background: #FFF1F2;
            --color-background-light: #FFE4E6;
            --color-background-card: #FFFFFF;
            --color-text-primary: #1C1917;
            --color-text-secondary: #44403C;
            --color-text-muted: #9D174D;
            --color-border: rgba(236, 72, 153, 0.2);
            --color-glow: rgba(249, 115, 22, 0.2);
            /* Darker block colors for light backgrounds */
            --block-neuro1: #D97706;
            --block-neuro2: #2563EB;
            --block-psych: #1D4ED8;
            --block-derm: #CA8A04;
            --block-special: #059669;
            --block-exam: #EA580C;
            --block-lab: #BE185D;
            --block-law: #475569;
        }

        /* Theme: Lavender Dreams (Dark)
           Deep purple/violet backgrounds with pink/lavender accents
           WCAG AAA: 15+ contrast ratio */
        [data-theme="lavender"] {
            --color-primary: #C084FC;
            --color-primary-light: #D8B4FE;
            --color-primary-dark: #A855F7;
            --color-accent: #F472B6;
            --color-accent-light: #F9A8D4;
            --color-background: #1E1033;
            --color-background-light: #2D1B4E;
            --color-background-card: #3D2663;
            --color-text-primary: #FAF5FF;
            --color-text-secondary: #E9D5FF;
            --color-text-muted: #D8B4FE;
            --color-border: rgba(192, 132, 252, 0.25);
            --color-glow: rgba(244, 114, 182, 0.3);
            /* CVD-safe block colors for dark themes */
            --block-neuro1: #F59E0B;
            --block-neuro2: #60A5FA;
            --block-psych: #3B82F6;
            --block-derm: #FCD34D;
            --block-special: #34D399;
            --block-exam: #F97316;
            --block-lab: #F472B6;
            --block-law: #94A3B8;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-background);
            color: var(--color-text-primary);
            -webkit-font-smoothing: antialiased;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(to bottom, var(--color-background) 0%, var(--color-background) 90%, transparent 100%);
            padding: 12px 16px 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .title-section h1 {
            font-size: 1.3rem;
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .title-section .subtitle {
            font-size: 0.7rem;
            color: var(--color-text-muted);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .live-clock {
            text-align: right;
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-accent);
        }

        .live-clock .date {
            font-size: 0.65rem;
            color: var(--color-text-muted);
            font-weight: 400;
        }

        .theme-toggle {
            display: flex;
            gap: 6px;
            padding: 4px 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
        }

        .theme-dot-btn {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .theme-dot-btn:hover { opacity: 1; transform: scale(1.1); }
        .theme-dot-btn.active { opacity: 1; transform: scale(1.15); box-shadow: 0 0 8px rgba(255,255,255,0.4), 0 2px 4px rgba(0,0,0,0.3); }
        .theme-dot-btn.midnight { background: linear-gradient(135deg, #22D3EE, #818CF8); }
        .theme-dot-btn.ocean { background: linear-gradient(135deg, #F59E0B, #14B8A6); }
        .theme-dot-btn.cream { background: linear-gradient(135deg, #F59E0B, #7C3AED); }
        .theme-dot-btn.arctic { background: linear-gradient(135deg, #F43F5E, #3B82F6); }
        .theme-dot-btn.rose { background: linear-gradient(135deg, #EC4899, #F97316); }
        .theme-dot-btn.lavender { background: linear-gradient(135deg, #C084FC, #F472B6); }

        /* Daily Quote */
        .daily-quote {
            background: linear-gradient(135deg, var(--color-background-card), var(--color-background-light));
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 10px;
            border: 1px solid var(--color-border);
            text-align: center;
        }

        .quote-text {
            font-style: italic;
            font-size: 0.85rem;
            color: var(--color-text-primary);
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .quote-verse {
            font-size: 0.7rem;
            color: var(--color-accent);
            font-weight: 600;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            background: var(--color-background-card);
            border-radius: 12px;
            border: 1px solid var(--color-border);
        }

        .status-bar.in-class {
            border-color: var(--block-special);
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .status-badge.upcoming { background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light)); }
        .status-badge.in-progress { background: linear-gradient(135deg, #22C55E, #4ADE80); animation: pulse 2s infinite; }
        .status-badge.done { background: linear-gradient(135deg, var(--color-accent), var(--color-accent-light)); color: #0F172A; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status-info {
            flex: 1;
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .status-info strong { color: var(--color-accent); }

        /* Final Countdown */
        .countdown-container {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .final-countdown {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, var(--color-background-card), var(--color-background-light));
            border-radius: 12px;
            border: 1px solid var(--color-border);
        }

        .final-countdown .countdown-icon {
            font-size: 1.2rem;
        }

        .final-countdown .countdown-text {
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        .final-countdown .countdown-days {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-accent);
        }

        .final-countdown .countdown-label {
            font-size: 0.65rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
        }

        /* Cooked Tip */
        .cooked-tip {
            margin-top: 8px;
            padding: 10px 14px;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(239, 68, 68, 0.1));
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cooked-tip:hover {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.25), rgba(239, 68, 68, 0.15));
            transform: translateY(-1px);
        }

        .cooked-tip-fire {
            font-size: 1.3rem;
            animation: fireWave 0.6s ease-in-out infinite;
        }

        .cooked-tip-content {
            flex: 1;
        }

        .cooked-tip-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: #F97316;
            margin-bottom: 2px;
        }

        .cooked-tip-desc {
            font-size: 0.7rem;
            color: var(--color-text-muted);
        }

        .cooked-tip-arrow {
            font-size: 0.9rem;
            color: #F97316;
            opacity: 0.7;
        }

        /* Calendar Container */
        .calendar-container {
            flex: 1;
            overflow-y: auto;
            padding: 185px 12px 80px;
            scroll-behavior: smooth;
        }

        .calendar-container::-webkit-scrollbar { width: 5px; }
        .calendar-container::-webkit-scrollbar-track { background: transparent; }
        .calendar-container::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 3px; }

        /* Week & Block Headers */
        .week-container { margin-bottom: 4px; }
        .week-header {
            background: linear-gradient(135deg, var(--color-primary-dark), var(--color-primary));
            padding: 8px 14px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            margin: 16px 0 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: opacity 0.2s;
        }
        .week-header:hover { opacity: 0.9; }
        .week-header:active { opacity: 0.8; }
        .week-toggle { font-size: 0.7rem; transition: transform 0.3s ease; }
        .week-container.collapsed .week-toggle { transform: rotate(-90deg); }
        .week-content { transition: all 0.3s ease; }
        .week-container.collapsed .week-content { display: none; }
        .week-container.collapsed .week-header { opacity: 0.7; margin-bottom: 0; }

        .block-header {
            background: linear-gradient(135deg, var(--color-accent), var(--color-accent-light));
            color: #0F172A;
            padding: 6px 14px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.75rem;
            text-align: center;
            margin: 10px 0 6px;
        }

        /* Day Card */
        .day-card {
            background: var(--color-background-card);
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--color-border);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            border-color: var(--color-primary);
            box-shadow: 0 6px 25px rgba(0,0,0,0.3);
        }

        .day-card.today {
            border: 2px solid var(--color-accent);
            box-shadow: 0 0 25px var(--color-glow);
        }

        /* Past days - lighter opacity */
        .day-card.past {
            opacity: 0.5;
        }
        .day-card.past:hover {
            opacity: 0.7;
        }

        /* Today's card - full opacity */
        .day-card.today {
            opacity: 1;
        }

        .day-header {
            padding: 10px 14px;
            background: var(--color-background-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
        }

        .day-header .day-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .day-header .badges { display: flex; gap: 5px; }

        .badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge.today-badge { background: var(--color-accent); color: #0F172A; }
        .badge.exam-badge { background: var(--block-exam); color: #fff; }
        .badge.money-badge { background: linear-gradient(135deg, #15803D, #22C55E); color: #FEF9C3; }

        .classes-list { padding: 6px; }

        /* Class Item */
        .class-item {
            background: var(--color-background-light);
            border-radius: 10px;
            margin: 5px 0;
            border-left: 4px solid;
            overflow: hidden;
            transition: all 0.3s;
            opacity: 1;
        }

        .class-item:hover { transform: translateX(3px); background: rgba(255,255,255,0.03); }

        .class-item[data-block="neuro1"] { border-color: var(--block-neuro1); }
        .class-item[data-block="neuro2"] { border-color: var(--block-neuro2); }
        .class-item[data-block="psych"] { border-color: var(--block-psych); }
        .class-item[data-block="derm"] { border-color: var(--block-derm); }
        .class-item[data-block="special"] { border-color: var(--block-special); }
        .class-item[data-block="exam"] { border-color: var(--block-exam); }
        .class-item[data-block="lab"] { border-color: var(--block-lab); }
        .class-item[data-block="law"] { border-color: var(--block-law); }

        .class-item.current {
            background: rgba(74, 222, 128, 0.15);
            border-color: var(--block-special) !important;
            animation: liveGlow 2s infinite;
        }

        @keyframes liveGlow {
            0%, 100% { box-shadow: inset 0 0 0 0 rgba(74, 222, 128, 0.1); }
            50% { box-shadow: inset 0 0 20px 0 rgba(74, 222, 128, 0.15); }
        }

        /* Completed classes - lighter opacity but still readable */
        .class-item.completed {
            opacity: 0.55;
        }

        /* Past day's classes are already faded by parent, so don't double-fade */
        .day-card.past .class-item.completed {
            opacity: 1;
        }

        .class-main {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            cursor: pointer;
            gap: 10px;
        }

        .class-time { width: 130px; flex-shrink: 0; }

        .class-time .time-range {
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--color-text-primary);
        }

        .class-time .countdown {
            font-size: 0.65rem;
            color: var(--color-accent);
            margin-top: 2px;
        }

        .class-info { flex: 1; min-width: 0; }

        .class-name {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .class-details {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .class-status {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .class-status.completed { background: rgba(74, 222, 128, 0.15); color: #86EFAC; }
        .class-status.in-progress { background: rgba(74, 222, 128, 0.25); color: #BBF7D0; }
        .class-status.upcoming { background: rgba(255,255,255,0.08); color: var(--color-text-secondary); }

        /* Light theme overrides for status badges */
        [data-theme="cream"] .class-status.completed { background: rgba(5, 150, 105, 0.15); color: #047857; }
        [data-theme="cream"] .class-status.in-progress { background: rgba(5, 150, 105, 0.2); color: #047857; }
        [data-theme="cream"] .class-status.upcoming { background: rgba(0,0,0,0.06); }
        [data-theme="arctic"] .class-status.completed { background: rgba(5, 150, 105, 0.15); color: #047857; }
        [data-theme="arctic"] .class-status.in-progress { background: rgba(5, 150, 105, 0.2); color: #047857; }
        [data-theme="arctic"] .class-status.upcoming { background: rgba(0,0,0,0.06); }

        .expand-icon {
            font-size: 0.75rem;
            color: var(--color-accent);
            transition: transform 0.3s;
        }

        .class-item.expanded .expand-icon { transform: rotate(180deg); }

        /* Study Materials */
        .study-materials {
            display: none;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-top: 1px solid var(--color-border);
        }

        .class-item.expanded .study-materials { display: block; }

        .materials-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .materials-header h4 {
            font-size: 0.8rem;
            color: var(--color-accent);
        }

        .material-bubbles {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .material-bubble {
            padding: 4px 10px;
            border-radius: 15px;
            background: rgba(255,255,255,0.08);
            font-size: 0.65rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .material-bubble:hover { background: var(--color-primary); color: #fff; }
        .material-bubble.active { background: var(--color-primary); color: #fff; }
        .material-bubble .count {
            background: rgba(255,255,255,0.2);
            padding: 1px 5px;
            border-radius: 8px;
            font-size: 0.55rem;
        }

        .materials-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 200px;
            overflow-y: auto;
        }

        .material-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: var(--color-background-card);
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .material-item:hover { background: rgba(255,255,255,0.05); transform: translateX(2px); }

        .material-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .material-icon.game { background: rgba(74, 222, 128, 0.2); }
        .material-icon.guide { background: rgba(56, 189, 248, 0.2); }
        .material-icon.quiz { background: rgba(251, 146, 60, 0.2); }
        .material-icon.notes { background: rgba(167, 139, 250, 0.2); }
        .material-icon.video { background: rgba(248, 113, 113, 0.2); }
        .material-icon.other { background: rgba(148, 163, 184, 0.2); }

        .material-info { flex: 1; min-width: 0; }

        .material-name {
            font-weight: 600;
            font-size: 0.75rem;
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .material-meta {
            font-size: 0.6rem;
            color: var(--color-text-muted);
        }

        .star-rating { display: flex; gap: 1px; }

        .star {
            font-size: 0.8rem;
            cursor: pointer;
            color: var(--color-text-muted);
            transition: color 0.2s, transform 0.2s;
        }

        .star:hover { transform: scale(1.2); }
        .star.filled { color: #FBBF24; }
        .star.hovered { color: #FDE68A; }

        .avg-rating {
            font-size: 0.6rem;
            color: var(--color-accent);
            margin-left: 4px;
        }

        .holiday-notice {
            text-align: center;
            padding: 20px;
            color: var(--color-accent);
            font-size: 1rem;
            font-weight: 600;
        }

        .event-banner {
            background: linear-gradient(135deg, #15803D 0%, #22C55E 50%, #15803D 100%);
            background-size: 200% 200%;
            animation: moneyShine 2s ease infinite;
            color: #FEF9C3;
            text-align: center;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
        }

        @keyframes moneyShine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 12px 16px;
            background: var(--color-background-card);
            border-top: 1px solid var(--color-border);
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--color-text-muted);
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .nav-btn:hover { background: rgba(255,255,255,0.05); color: var(--color-text-primary); }
        .nav-btn.active { color: var(--color-accent); background: rgba(34, 211, 238, 0.1); }

        .nav-btn .icon { font-size: 1.2rem; }
        .nav-btn .label { font-size: 0.65rem; font-weight: 600; }

        /* Overview Modal */
        .overview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
        }

        .overview-modal.active { display: block; }

        .overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: rgba(15, 23, 42, 0.95);
            padding: 10px 0;
            z-index: 10;
        }

        .overview-header h2 {
            font-size: 1.2rem;
            color: var(--color-accent);
        }

        .close-overview {
            background: var(--color-primary);
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }

        .overview-week {
            background: var(--color-background-card);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid var(--color-border);
        }

        .overview-week h3 {
            font-size: 0.85rem;
            color: var(--color-primary-light);
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--color-border);
        }

        .overview-day {
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .overview-day:last-child { border-bottom: none; }

        .overview-day-name {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            margin-bottom: 4px;
        }

        .overview-day.today .overview-day-name { color: var(--color-accent); font-weight: 700; }
        .overview-day.past { opacity: 0.4; }

        .overview-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .overview-topic {
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--color-background-light);
        }

        .overview-topic.exam { background: rgba(248, 113, 113, 0.3); color: #FCA5A5; }
        .overview-topic.holiday { background: rgba(34, 211, 238, 0.2); color: var(--color-accent); }

        /* Exams Modal */
        .exams-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
        }

        .exams-modal.active { display: block; }

        .exams-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: var(--color-background);
            padding: 10px 0;
            z-index: 10;
        }

        .exams-header h2 {
            font-size: 1.2rem;
            color: var(--color-accent);
        }

        .close-exams {
            background: var(--color-primary);
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .exams-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .exam-section {
            background: var(--color-background-card);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--color-border);
        }

        .exam-section-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-primary-light);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .exam-section-title .icon {
            font-size: 1.1rem;
        }

        .exam-list {
            display: flex;
            flex-direction: column;
        }

        .exam-item {
            position: relative;
            display: flex;
            align-items: center;
            padding: 12px;
            padding-right: 80px;
            background: var(--color-background-light);
            border-radius: 8px;
            border-left: 4px solid var(--block-exam);
            transition: all 0.2s;
        }

        .exam-item:not(.exam-item-draggable):hover {
            transform: translateX(4px);
            background: rgba(255,255,255,0.03);
        }

        .exam-item:not(.exam-item-draggable) {
            margin-bottom: 8px;
        }

        .exam-item.quiz {
            border-left-color: var(--block-lab);
        }

        .exam-item.completed {
            opacity: 0.5;
        }

        .exam-item.today {
            border-left-color: var(--color-accent);
            box-shadow: 0 0 12px var(--color-glow);
        }

        .exam-date {
            min-width: 100px;
            text-align: center;
            padding-right: 12px;
            border-right: 1px solid var(--color-border);
            margin-right: 12px;
        }

        .exam-date .day {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
        }

        .exam-date .date {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .exam-date .countdown {
            font-size: 0.65rem;
            color: var(--color-accent);
            margin-top: 2px;
        }

        .exam-info {
            flex: 1;
        }

        .exam-name {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--color-text-primary);
            margin-bottom: 2px;
        }

        .exam-details {
            font-size: 0.7rem;
            color: var(--color-text-muted);
        }

        .exam-type-badge {
            position: absolute;
            right: 8px;
            top: 8px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .exam-type-badge.pda { background: rgba(249, 115, 22, 0.2); color: #FB923C; }
        .exam-type-badge.ther { background: rgba(59, 130, 246, 0.2); color: #60A5FA; }
        .exam-type-badge.pcl { background: rgba(168, 85, 247, 0.2); color: #C084FC; }
        .exam-type-badge.final { background: rgba(239, 68, 68, 0.2); color: #F87171; }
        .exam-type-badge.quiz { background: rgba(232, 121, 249, 0.2); color: #E879F9; }

        /* Am I Cooked - Swipe to Reveal */
        .exam-swipe-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .cooked-reveal {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            background: linear-gradient(135deg, #F97316 0%, #EF4444 50%, #DC2626 100%);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 24px;
            gap: 12px;
            cursor: pointer;
        }

        .cooked-reveal:hover {
            background: linear-gradient(135deg, #FB923C 0%, #F87171 50%, #EF4444 100%);
        }

        .cooked-fire {
            font-size: 2rem;
            animation: fireWave 0.6s ease-in-out infinite;
        }

        .cooked-fire:nth-child(2) {
            animation-delay: 0.1s;
        }

        .cooked-fire:nth-child(3) {
            animation-delay: 0.2s;
        }

        @keyframes fireWave {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-4px) scale(1.1); }
        }

        .cooked-text {
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            white-space: nowrap;
        }

        .exam-item-draggable {
            position: relative;
            z-index: 2;
            background: var(--color-background-light);
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: grab;
            touch-action: pan-y pinch-zoom;
            user-select: none;
        }

        .exam-item-draggable:active {
            cursor: grabbing;
        }

        .exam-item-draggable.dragging {
            transition: none;
        }

        .exam-item-draggable.released {
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .swipe-hint {
            position: absolute;
            right: 8px;
            bottom: 6px;
            font-size: 0.55rem;
            color: var(--color-text-muted);
            opacity: 0.5;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .swipe-hint-arrow {
            animation: swipeHintPulse 1.5s ease-in-out infinite;
        }

        @keyframes swipeHintPulse {
            0%, 100% { transform: translateX(0); opacity: 0.6; }
            50% { transform: translateX(-4px); opacity: 1; }
        }

        /* Quiz Modal */
        .quiz-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('assets/jail-bg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .quiz-modal.show { display: flex; }

        .quiz-modal-content {
            background: var(--color-background);
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--color-border);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--color-border);
        }

        .quiz-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .quiz-close {
            background: none;
            border: none;
            color: var(--color-text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px;
        }

        .quiz-close:hover { color: var(--color-text-primary); }

        .quiz-progress {
            text-align: center;
            font-size: 0.75rem;
            color: var(--color-accent);
            margin-bottom: 16px;
        }

        .quiz-question {
            font-size: 1rem;
            color: var(--color-text-primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            background: var(--color-background-light);
            border: 1px solid var(--color-border);
            border-radius: 10px;
            padding: 14px 16px;
            color: var(--color-text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }

        .quiz-option:hover:not(:disabled) {
            background: var(--color-background-card);
            border-color: var(--color-primary);
        }

        .quiz-option.correct {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22C55E;
            color: #86EFAC;
        }

        .quiz-option.wrong {
            background: rgba(239, 68, 68, 0.2);
            border-color: #EF4444;
            color: #FCA5A5;
        }

        .quiz-result {
            text-align: center;
            padding: 20px 0;
        }

        .result-emoji {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .result-score {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }

        .result-verdict {
            font-size: 1.2rem;
            color: var(--color-accent);
            margin-bottom: 24px;
        }

        .quiz-close-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
        }

        .quiz-close-btn:hover { opacity: 0.9; }

        /* Select All That Apply Styles */
        .quiz-select-all .quiz-option {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-option.selected {
            background: rgba(129, 140, 248, 0.2);
            border-color: var(--color-primary);
        }

        .quiz-option.selected .checkbox-icon {
            color: var(--color-primary);
        }

        .checkbox-icon {
            font-size: 1.2rem;
            min-width: 24px;
            color: var(--color-text-muted);
        }

        .quiz-submit-btn {
            margin-top: 16px;
            width: 100%;
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .quiz-submit-btn:hover { opacity: 0.9; }
        .quiz-submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Quiz Feedback & Next Button */
        .quiz-feedback {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            animation: fadeSlideIn 0.3s ease;
        }
        .quiz-feedback.correct {
            background: rgba(34, 197, 94, 0.15);
            color: #22C55E;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        .quiz-feedback.wrong {
            background: rgba(239, 68, 68, 0.15);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .quiz-next-btn {
            margin-top: 12px;
            width: 100%;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .quiz-next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }
        .quiz-next-btn:active {
            transform: translateY(0);
        }
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Matching Question Styles */
        .match-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .match-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .match-item {
            background: var(--color-background-light);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .match-item:hover:not(.paired) {
            border-color: var(--color-primary);
        }

        .match-item.active {
            border-color: var(--color-primary);
            background: rgba(129, 140, 248, 0.15);
            box-shadow: 0 0 0 2px rgba(129, 140, 248, 0.3);
        }

        .match-item.paired {
            opacity: 0.5;
            pointer-events: none;
            border-style: dashed;
        }

        .match-number, .match-letter {
            font-weight: 700;
            color: var(--color-accent);
            min-width: 20px;
            flex-shrink: 0;
        }

        .match-text {
            flex: 1;
        }

        .match-pairs {
            margin-top: 12px;
            padding: 10px;
            background: var(--color-background-light);
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .match-pair-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid var(--color-border);
        }

        .match-pair-item:last-child { border-bottom: none; }

        .match-pair-remove {
            color: #EF4444;
            cursor: pointer;
            font-weight: bold;
            margin-left: 8px;
        }

        /* Hint Card Styles */
        .quiz-hint {
            text-align: center;
            padding: 24px 16px;
        }

        .hint-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .hint-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #F59E0B;
            margin-bottom: 16px;
        }

        .hint-text {
            font-size: 1rem;
            color: var(--color-text-primary);
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
            font-weight: 600;
            line-height: 1.5;
        }

        .hint-continue-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .hint-continue-btn:hover { opacity: 0.9; }

        /* Question type indicator */
        .quiz-type-badge {
            display: inline-block;
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 4px;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .quiz-type-badge.mc { background: rgba(34, 211, 238, 0.2); color: #22D3EE; }
        .quiz-type-badge.select { background: rgba(168, 85, 247, 0.2); color: #A855F7; }
        .quiz-type-badge.match { background: rgba(251, 146, 60, 0.2); color: #FB923C; }

        /* Mobile: Stack matching columns */
        @media (max-width: 500px) {
            .match-container {
                grid-template-columns: 1fr;
            }

            .match-left { order: 1; }
            .match-right {
                order: 2;
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px dashed var(--color-border);
            }

            .match-item {
                padding: 12px;
            }
        }

        .exam-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: var(--color-background-light);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--color-border);
        }

        .stat-card .number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent);
        }

        .stat-card .label {
            font-size: 0.65rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
            margin-top: 2px;
        }

        .law-practice-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--block-law) 0%, #64748b 100%);
            border-radius: 12px;
            padding: 14px 20px;
            margin: 16px 0;
            text-decoration: none;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .law-practice-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .law-practice-link:active {
            transform: translateY(0);
        }

        .law-practice-link .icon {
            font-size: 1.2rem;
        }

        .law-practice-link .text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .law-practice-link .text .main {
            font-weight: 600;
        }

        .law-practice-link .text .sub {
            font-size: 0.7rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .law-practice-link .arrow {
            margin-left: auto;
            font-size: 1.1rem;
            opacity: 0.8;
        }

        /* Current indicator - green background applied via .class-item.current */

        @media (max-width: 500px) {
            .header { padding: 10px 12px 16px; }
            .title-section h1 { font-size: 1.1rem; }
            .calendar-container { padding-top: 200px; }
            .class-main { padding: 8px 10px; }
            .class-time { width: 115px; flex-shrink: 0; }
            .class-status { display: none; }
            /* Mobile countdown optimizations */
            .countdown-container { flex-direction: column; gap: 6px; }
            .final-countdown { padding: 8px 10px; gap: 6px; }
            .final-countdown .countdown-text { font-size: 0.7rem; }
            .final-countdown .countdown-days { font-size: 1rem; }
            .final-countdown .countdown-label { font-size: 0.65rem; }
            /* Larger theme dots for touch */
            .theme-dot-btn { width: 22px; height: 22px; }
            .theme-toggle { gap: 8px; padding: 5px 8px; }
        }

        /* iPad and tablet optimizations */
        @media (min-width: 501px) and (max-width: 1024px) {
            .header { padding: 12px 20px 20px; }
            .calendar-container { padding: 180px 12px 80px; }
            .class-item { margin-bottom: 8px; }
        }

        /* Tutorial Modal */
        .tutorial-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 300;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .tutorial-modal.active { display: flex; }

        .tutorial-content {
            background: var(--color-background-card);
            border-radius: 16px;
            padding: 24px;
            max-width: 380px;
            width: 100%;
            border: 1px solid var(--color-border);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .tutorial-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .tutorial-header .icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .tutorial-header h2 {
            font-size: 1.3rem;
            color: var(--color-text-primary);
            margin-bottom: 6px;
        }

        .tutorial-header p {
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }

        .tutorial-steps {
            margin-bottom: 20px;
        }

        .tutorial-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: var(--color-background-light);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .tutorial-step:last-child { margin-bottom: 0; }

        .step-number {
            width: 28px;
            height: 28px;
            min-width: 28px;
            background: var(--color-primary);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .step-content {
            flex: 1;
        }

        .step-content strong {
            display: block;
            color: var(--color-text-primary);
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .step-content span {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .tutorial-footer {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tutorial-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--color-background-light);
            border-radius: 8px;
            cursor: pointer;
        }

        .tutorial-checkbox input {
            width: 18px;
            height: 18px;
            accent-color: var(--color-primary);
        }

        .tutorial-checkbox span {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        .tutorial-close-btn {
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            border: none;
            border-radius: 10px;
            color: #fff;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .tutorial-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--color-glow);
        }

        .platform-note {
            text-align: center;
            font-size: 0.7rem;
            color: var(--color-text-muted);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--color-border);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="title-section">
                <h1>WCU School of Pharmacy</h1>
                <div class="subtitle">Drug Action & Therapeutics  P2 Spring 2026</div>
            </div>
            <div class="header-controls">
                <div class="live-clock">
                    <div id="live-time">--:--:--</div>
                    <div class="date" id="live-date">---</div>
                </div>
                <div class="theme-toggle">
                    <button class="theme-dot-btn midnight active" data-theme="midnight" onclick="setTheme('midnight')" title="Midnight Indigo (Dark)"></button>
                    <button class="theme-dot-btn ocean" data-theme="ocean" onclick="setTheme('ocean')" title="Ocean Depths (Dark)"></button>
                    <button class="theme-dot-btn cream" data-theme="cream" onclick="setTheme('cream')" title="Cream & Coffee (Light)"></button>
                    <button class="theme-dot-btn arctic" data-theme="arctic" onclick="setTheme('arctic')" title="Arctic Frost (Light)"></button>
                    <button class="theme-dot-btn rose" data-theme="rose" onclick="setTheme('rose')" title="Rose Garden (Light)"></button>
                    <button class="theme-dot-btn lavender" data-theme="lavender" onclick="setTheme('lavender')" title="Lavender Dreams (Dark)"></button>
                </div>
            </div>
        </div>
        <div class="daily-quote" id="daily-quote">
            <div class="quote-text" id="quote-text">"Loading daily encouragement..."</div>
            <div class="quote-verse" id="quote-verse"></div>
        </div>
        <div class="status-bar" id="status-bar">
            <span class="status-badge upcoming" id="status-badge">Loading</span>
            <span class="status-info" id="status-info">...</span>
        </div>
        <div class="countdown-container">
            <div class="final-countdown" id="next-final-countdown">
                <span class="countdown-icon"></span>
                <span class="countdown-text">Next Exam in</span>
                <span class="countdown-days" id="next-final-days">--</span>
                <span class="countdown-label">Days</span>
            </div>
            <div class="final-countdown" id="final-countdown">
                <span class="countdown-icon"></span>
                <span class="countdown-text">Last Final in</span>
                <span class="countdown-days" id="final-days">--</span>
                <span class="countdown-label">Days</span>
            </div>
        </div>
        <div class="cooked-tip" onclick="showExams()">
            <span class="cooked-tip-fire"></span>
            <div class="cooked-tip-content">
                <div class="cooked-tip-title">How cooked am I?</div>
                <div class="cooked-tip-desc">Tap Exams  swipe any exam left to test yourself</div>
            </div>
            <span class="cooked-tip-arrow"></span>
        </div>
    </div>

    <div class="calendar-container" id="calendar-container">
        <div id="calendar"></div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn active" onclick="scrollToNow()">
            <span class="icon"></span>
            <span class="label">Now</span>
        </button>
        <button class="nav-btn" onclick="showExams()">
            <span class="icon"></span>
            <span class="label">Exams</span>
        </button>
        <a class="nav-btn" href="https://therapeutics-4u.vercel.app/" target="_blank">
            <span class="icon"></span>
            <span class="label">Game</span>
        </a>
        <button class="nav-btn" onclick="showOverview()">
            <span class="icon"></span>
            <span class="label">Overview</span>
        </button>
        <button class="nav-btn" onclick="scrollToTop()">
            <span class="icon"></span>
            <span class="label">Top</span>
        </button>
    </div>

    <!-- Overview Modal -->
    <div class="overview-modal" id="overview-modal">
        <div class="overview-header">
            <h2> Full Calendar Overview</h2>
            <button class="close-overview" onclick="hideOverview()">Close</button>
        </div>
        <div class="overview-grid" id="overview-grid"></div>
    </div>

    <!-- Exams Modal -->
    <div class="exams-modal" id="exams-modal">
        <div class="exams-header">
            <h2> Exams & Quizzes</h2>
            <button class="close-exams" onclick="hideExams()">Close</button>
        </div>
        <div class="exams-content" id="exams-content"></div>
    </div>

    <!-- Tutorial Modal -->
    <div class="tutorial-modal" id="tutorial-modal">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <div class="icon"></div>
                <h2>Add to Home Screen</h2>
                <p>Get quick access to your calendar like an app!</p>
            </div>
            <div class="tutorial-steps" id="tutorial-steps">
                <!-- Steps will be populated by JavaScript based on platform -->
            </div>
            <div class="tutorial-footer">
                <label class="tutorial-checkbox">
                    <input type="checkbox" id="tutorial-dont-show">
                    <span>Don't show this again</span>
                </label>
                <button class="tutorial-close-btn" onclick="closeTutorial()">Got it!</button>
            </div>
            <div class="platform-note" id="platform-note"></div>
        </div>
    </div>

    <!-- Am I Cooked Quiz Modal -->
    <div class="quiz-modal" id="quiz-modal">
        <div class="quiz-modal-content">
            <div class="quiz-header">
                <span class="quiz-title" id="quiz-title"> Am I Cooked?</span>
                <button class="quiz-close" onclick="closeQuizModal()"></button>
            </div>
            <div id="quiz-content">
                <!-- Quiz questions populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Get current time in Central Time (Mississippi)
        function getCentralTime() {
            return new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' }));
        }

        // Tutorial Modal - Add to Home Screen
        function detectPlatform() {
            const ua = navigator.userAgent;
            if (/iPad|iPhone|iPod/.test(ua)) return 'ios';
            if (/Android/.test(ua)) return 'android';
            return 'desktop';
        }

        function showTutorial() {
            const platform = detectPlatform();
            const stepsContainer = document.getElementById('tutorial-steps');
            const platformNote = document.getElementById('platform-note');

            // Always show iOS instructions since this is for pharmacy students mostly on iPhones/iPads
            const steps = `
                <div class="tutorial-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <strong>Tap the Share button <span style="font-size:1.2em"></span></strong>
                        <span>Look for the square with an arrow at the bottom of Safari</span>
                    </div>
                </div>
                <div class="tutorial-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <strong>Tap "Add to Home Screen" <span style="font-size:1.2em"></span></strong>
                        <span>Scroll down in the share menu to find it</span>
                    </div>
                </div>
                <div class="tutorial-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <strong>Tap "Add" in the top right corner</strong>
                        <span>The calendar app icon will appear on your home screen!</span>
                    </div>
                </div>
            `;

            if (platform === 'ios') {
                platformNote.innerHTML = ' <strong>You\'re on iPhone/iPad!</strong> Use Safari for best results.';
            } else if (platform === 'android') {
                platformNote.innerHTML = ' On Android? Tap  menu  "Add to Home screen"';
            } else {
                platformNote.innerHTML = ' <strong>Pro tip:</strong> Open this on your iPhone for the best experience!';
            }

            stepsContainer.innerHTML = steps;
            document.getElementById('tutorial-modal').classList.add('active');
        }

        function closeTutorial() {
            const dontShowAgain = document.getElementById('tutorial-dont-show').checked;
            if (dontShowAgain) {
                localStorage.setItem('hideTutorial', 'true');
            }
            document.getElementById('tutorial-modal').classList.remove('active');
        }

        function checkShowTutorial() {
            const hideTutorial = localStorage.getItem('hideTutorial');
            // Check if running as installed PWA (standalone mode)
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                                 window.navigator.standalone === true;

            if (!hideTutorial && !isStandalone) {
                // Small delay to let page render first
                setTimeout(showTutorial, 500);
            }
        }

        // Show tutorial on load
        document.addEventListener('DOMContentLoaded', checkShowTutorial);

        // Daily Quotes - Christian Authors, Pharmacists & Healthcare Pioneers, Bible Verses
        const dailyQuotes = [
            // C.S. Lewis (8)
            { text: "I believe in Christianity as I believe the sun has risen: not only because I see it, but because by it I see everything else.", author: "C.S. Lewis" },
            { text: "Aim at heaven and you will get earth thrown in. Aim at earth and you get neither.", author: "C.S. Lewis" },
            { text: "You are never too old to set another goal or to dream a new dream.", author: "C.S. Lewis" },
            { text: "Hardships often prepare ordinary people for an extraordinary destiny.", author: "C.S. Lewis" },
            { text: "There are far, far better things ahead than any we leave behind.", author: "C.S. Lewis" },
            { text: "The Christian does not think God will love us because we are good, but that God will make us good because He loves us.", author: "C.S. Lewis" },
            { text: "Faith is the art of holding on to things your reason has accepted, in spite of your changing moods.", author: "C.S. Lewis" },
            { text: "To be a Christian means to forgive the inexcusable because God has forgiven the inexcusable in you.", author: "C.S. Lewis" },
            // Corrie ten Boom (6)
            { text: "Never be afraid to trust an unknown future to a known God.", author: "Corrie ten Boom" },
            { text: "Worry does not empty tomorrow of its sorrow; it empties today of its strength.", author: "Corrie ten Boom" },
            { text: "There is no pit so deep that God's love is not deeper still.", author: "Corrie ten Boom" },
            { text: "If you look at the world, you'll be distressed. If you look within, you'll be depressed. If you look at God, you'll be at rest.", author: "Corrie ten Boom" },
            { text: "Faith sees the invisible, believes the unbelievable, and receives the impossible.", author: "Corrie ten Boom" },
            { text: "Every experience God gives us is the perfect preparation for a future only He can see.", author: "Corrie ten Boom" },
            // Billy Graham (5)
            { text: "God will not take us where the grace of God cannot sustain us.", author: "Billy Graham" },
            { text: "Mountaintops are for views and inspiration, but fruit is grown in the valleys.", author: "Billy Graham" },
            { text: "When we come to the end of ourselves, we come to the beginning of God.", author: "Billy Graham" },
            { text: "Being a Christian is not an instantaneous conversionit is a daily process of becoming more like Christ.", author: "Billy Graham" },
            { text: "God has given us two hands: one to receive with and the other to give with.", author: "Billy Graham" },
            // Max Lucado (5)
            { text: "God never said the journey would be easy, but He did say the arrival would be worthwhile.", author: "Max Lucado" },
            { text: "Focus on giants, you stumble. Focus on God, your giants tumble.", author: "Max Lucado" },
            { text: "Faith is not believing God will do what we want. Faith is believing God will do what is right.", author: "Max Lucado" },
            { text: "You are valuable because you exist. Not because of what you do or what you have done.", author: "Max Lucado" },
            { text: "A woman's heart should be so hidden in God that a man has to seek Him just to find her.", author: "Max Lucado" },
            // Martin Luther King Jr. (5)
            { text: "Faith is taking the first step even when you don't see the whole staircase.", author: "Martin Luther King Jr." },
            { text: "Darkness cannot drive out darkness: only light can do that. Hate cannot drive out hate: only love can do that.", author: "Martin Luther King Jr." },
            { text: "If you can't fly, run. If you can't run, walk. If you can't walk, crawl. But by all means, keep moving.", author: "Martin Luther King Jr." },
            { text: "Our capacity to deal creatively with shattered dreams is determined by our faith in God.", author: "Martin Luther King Jr." },
            { text: "We must learn that to expect God to do everything while we do nothing is not faith but superstition.", author: "Martin Luther King Jr." },
            // Elisabeth Elliot (3)
            { text: "Faith does not eliminate questions. But faith knows where to take them.", author: "Elisabeth Elliot" },
            { text: "God never withholds from His child that which His love and wisdom call good.", author: "Elisabeth Elliot" },
            { text: "The secret is Christ in me, not me in a different set of circumstances.", author: "Elisabeth Elliot" },
            // John Piper (2)
            { text: "God is most glorified in us when we are most satisfied in Him.", author: "John Piper" },
            { text: "One of the great enemies of hope is forgetting God's promises.", author: "John Piper" },
            // Francis of Assisi (3)
            { text: "Start by doing what's necessary; then do what's possible; and suddenly you are doing the impossible.", author: "Francis of Assisi" },
            { text: "Lord, make me an instrument of your peace. Where there is hatred, let me sow love.", author: "Francis of Assisi" },
            { text: "I have been all things unholy. If God can work through me, He can work through anyone.", author: "Francis of Assisi" },
            // Nick Vujicic (3)
            { text: "I was never crippled until I lost hope.", author: "Nick Vujicic" },
            { text: "Fear is the biggest disability of all. It will paralyze you more than being in a wheelchair.", author: "Nick Vujicic" },
            { text: "I know for certain that God does not make mistakes, but He does make miracles. I am one. You are, too.", author: "Nick Vujicic" },
            // Pharmacists & Healthcare Pioneers (15)
            { text: "The pharmacist is one of the best friends your medicines can have.", author: "Hubert H. Humphrey" },
            { text: "The good physician treats the disease; the great physician treats the patient who has the disease.", author: "Sir William Osler" },
            { text: "Medicine is learned by the bedside and not in the classroom.", author: "Sir William Osler" },
            { text: "He who studies medicine without books sails an uncharted sea, but he who studies medicine without patients does not go to sea at all.", author: "Sir William Osler" },
            { text: "The value of experience is not in seeing much, but in seeing wisely.", author: "Sir William Osler" },
            { text: "Acquire the art of detachment, the virtue of method, and the quality of thoroughness, but above all the grace of humility.", author: "Sir William Osler" },
            { text: "The physician treats, but nature heals.", author: "Hippocrates" },
            { text: "Wherever the art of medicine is loved, there is also a love of humanity.", author: "Hippocrates" },
            { text: "Healing is a matter of time, but it is sometimes also a matter of opportunity.", author: "Hippocrates" },
            { text: "Cure sometimes, treat often, comfort always.", author: "Hippocrates" },
            { text: "It's far more important to know what person the disease has than what disease the person has.", author: "Hippocrates" },
            { text: "The art of healing comes from nature, not from the physician. Therefore the physician must start from nature, with an open mind.", author: "Paracelsus" },
            { text: "Medicine is not only a science; it is also an art. It deals with the very processes of life.", author: "Paracelsus" },
            { text: "Behind every prescription is a pharmacist ensuring safe healing journeys.", author: "Pharmacy Wisdom" },
            { text: "You are more than just a pill counter.", author: "Alex Barker" },
            // Key Bible Verses (10)
            { text: "I can do all things through Christ who strengthens me.", author: "Philippians 4:13" },
            { text: "For I know the plans I have for you, declares the Lord, plans to prosper you.", author: "Jeremiah 29:11" },
            { text: "Trust in the Lord with all your heart and lean not on your own understanding.", author: "Proverbs 3:5" },
            { text: "Those who hope in the Lord will renew their strength.", author: "Isaiah 40:31" },
            { text: "With God all things are possible.", author: "Matthew 19:26" },
            { text: "Be strong and courageous. Do not be afraid; do not be discouraged.", author: "Joshua 1:9" },
            { text: "Be still, and know that I am God.", author: "Psalm 46:10" },
            { text: "Whatever you do, work at it with all your heart, as working for the Lord.", author: "Colossians 3:23" },
            { text: "Let us not grow weary of doing good, for in due season we will reap.", author: "Galatians 6:9" },
            { text: "Cast all your anxiety on Him because He cares for you.", author: "1 Peter 5:7" }
        ];

        // Holiday-specific quotes (override daily rotation)
        const holidayQuotes = {
            "1-19": { text: "Darkness cannot drive out darkness: only light can do that. Hate cannot drive out hate: only love can do that.", author: "Martin Luther King Jr." },
            "2-14": { text: "Lord, make me an instrument of your peace. Where there is hatred, let me sow love.", author: "Francis of Assisi" },
            "2-18": { text: "I have been all things unholy. If God can work through me, He can work through anyone.", author: "Francis of Assisi" }
        };

        function getDailyQuote() {
            const now = getCentralTime();
            const dayOfWeek = now.getDay();
            // Show quotes on weekdays only (1-5)
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                document.getElementById('daily-quote').style.display = 'none';
                return;
            }
            // Check for holiday quote first
            const dateKey = `${now.getMonth() + 1}-${now.getDate()}`;
            let quote;
            if (holidayQuotes[dateKey]) {
                quote = holidayQuotes[dateKey];
            } else {
                // Use day of year to cycle through quotes
                const start = new Date(now.getFullYear(), 0, 0);
                const diff = now - start;
                const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
                quote = dailyQuotes[dayOfYear % dailyQuotes.length];
            }
            document.getElementById('quote-text').textContent = `"${quote.text}"`;
            document.getElementById('quote-verse').textContent = ` ${quote.author}`;
        }

        // Theme
        function setTheme(theme) {
            // Midnight is the default (no data-theme attribute needed)
            if (theme === 'midnight') document.documentElement.removeAttribute('data-theme');
            else document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('calendarTheme', theme);
            document.querySelectorAll('.theme-dot-btn').forEach(b => b.classList.toggle('active', b.dataset.theme === theme));
        }
        // Migrate old theme names to new ones
        const savedTheme = localStorage.getItem('calendarTheme');
        const themeMap = { 'default': 'midnight', 'blue': 'ocean', 'camo': 'cream', 'pink': 'arctic' };
        setTheme(themeMap[savedTheme] || savedTheme || 'midnight');

        // Schedule Data
        const schedule = [
            { week: 1, block: "Block 1: Neurology Part 1", date: "2026-01-12", classes: [
                { time: "08:30", end: "10:00", instructor: "Burmeister", topic: "Pathophysiology: Disorders of Movement", details: "Parkinson, RLS, Multiple Sclerosis", block: "neuro1" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Med Chem & Pharm: Antiparkinson agents", block: "neuro1" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Multiple Sclerosis agents", block: "neuro1" }
            ]},
            { week: 1, date: "2026-01-13", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Parkinson Disease/Restless Leg Syndrome", block: "neuro1" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "Parkinson Disease/Restless Leg Syndrome", block: "neuro1" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Smith", topic: "Law: Introduction to the MPJE", block: "law" }
            ]},
            { week: 1, date: "2026-01-14", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Lab", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "Multiple Sclerosis", block: "neuro1" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Lab", block: "lab" }
            ]},
            { week: 1, date: "2026-01-15", classes: [
                { time: "08:30", end: "10:00", instructor: "Burmeister", topic: "Pathophysiology: Neurocognitive disorders", block: "neuro1" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Neurocognitive disorders", block: "neuro1" },
                { time: "13:15", end: "14:45", instructor: "Burmeister/Lounsbury-Rivera", topic: "Neuroreceptor Review and Pain Pathways", block: "neuro1" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Federal Law and Regulations", block: "law" }
            ]},
            { week: 1, date: "2026-01-16", classes: [
                { time: "08:30", end: "10:00", instructor: "Burmeister", topic: "Pathophysiology: Epilepsy", block: "neuro1" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Med Chem: Antiepileptics, GABAergic", block: "neuro1" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Antiepileptics, GABAergic", block: "neuro1" }
            ]},
            { week: 2, date: "2026-01-19", holiday: "Martin Luther King Jr. Day" },
            { week: 2, date: "2026-01-20", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Neurocognitive disorders (Dementia)", block: "neuro1" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Epilepsy/Status Epilepticus", block: "neuro1" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Epilepsy/Refractory Epilepsy", details: "The Road to Status Epilepticus", block: "neuro1" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Federal Law and Regulations cont.", block: "law" }
            ]},
            { week: 2, date: "2026-01-21", event: " LOANS SHOULD BE HITTIN ", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Lab  Dementia Tour", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "Lab  Dementia Tour", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Lab  Dementia Tour", block: "lab" }
            ]},
            { week: 2, date: "2026-01-22", event: " LOANS SHOULD BE HITTIN ", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Complications of Antiepileptics", details: "DRESS, TENS, SJS | PT Quiz 1", block: "neuro1" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Pharmacy Operations", block: "law" }
            ]},
            { week: 2, date: "2026-01-23", event: " LOANS SHOULD BE HITTIN ", block: "Block 2: Neurology Part 2", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Principles of Drug Action Exam  Block 1", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "Burmeister", topic: "Pathophysiology: Somatosensory and Pain", block: "neuro2" },
                { time: "13:15", end: "14:45", instructor: "Burmeister", topic: "Pathophysiology: Somatosensory and Pain", block: "neuro2" }
            ]},
            { week: 3, date: "2026-01-26", classes: [
                { time: "08:30", end: "10:00", instructor: "Lounsbury-Rivera", topic: "Pathophysiology: Migraines and Headache", block: "neuro2" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Medicinal Chemistry: NSAIDs, Opioids", block: "neuro2" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Med Chem & Pharm: Muscle Relaxants", block: "neuro2" }
            ]},
            { week: 3, date: "2026-01-27", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Therapeutics Exam  Block 1", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: NSAIDs, Opioids", block: "neuro2" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Med Chem & Pharm: Triptans", details: "and other prophylactic agents", block: "neuro2" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Pharmacy Operations", details: "Quiz 1", block: "law" }
            ]},
            { week: 3, date: "2026-01-28", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Patient Care Lab Exam  Block 1", block: "exam" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Pain (nociceptive, neuropathic, inflammatory)", block: "neuro2" }
            ]},
            { week: 3, date: "2026-01-29", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Pain (nociceptive, neuropathic, inflammatory)", block: "neuro2" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Pain (nociceptive, neuropathic, inflammatory)", block: "neuro2" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Pharmacy Operations cont.", block: "law" }
            ]},
            { week: 3, date: "2026-01-30", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Reed/Lounsbury-Rivera", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Headache (Including Migraine)", block: "neuro2" }
            ]},
            { week: 4, date: "2026-02-02", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Headache (Including Migraine)", block: "neuro2" },
                { time: "10:15", end: "11:45", instructor: "Reed/Lounsbury-Rivera", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" }
            ]},
            { week: 4, date: "2026-02-03", classes: [
                { time: "08:30", end: "10:00", instructor: "C. Breese", topic: "Pathophysiology: Sleep Disorders", block: "neuro2" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Sleep Disorders", block: "neuro2" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Sleep-Wake Cycle Disorder", details: "narcolepsy/insomnia", block: "neuro2" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Pharmacy Operations cont.", block: "law" }
            ]},
            { week: 4, date: "2026-02-04", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Lab", details: "PT Quiz 2", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "ADHD", block: "neuro2" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Lab", block: "lab" }
            ]},
            { week: 4, date: "2026-02-05", block: "Block 3: Psychiatry", classes: [
                { time: "08:30", end: "10:00", instructor: "C. Breese", topic: "Pathophysiology: Anxiety/Depression", block: "psych" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Medicinal Chemistry: SSRI/SNRI/MAOI/etc.", block: "psych" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Med Chem & Pharm: SSRI/SNRI/MAOI", block: "psych" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Pharmacy Practice", block: "law" }
            ]},
            { week: 4, date: "2026-02-06", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Principles of Drug Action Exam  Block 2", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: SSRI/SNRI/MAOI/etc.", block: "psych" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Depression", block: "psych" }
            ]},
            { week: 5, date: "2026-02-09", classes: [
                { time: "08:30", end: "10:00", instructor: "Long", topic: "Depression", block: "psych" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "Anxiety/OCD/PTSD/Phobias", block: "psych" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Lab", block: "lab" }
            ]},
            { week: 5, date: "2026-02-10", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Therapeutics Exam  Block 2", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "", topic: "Law: Pharmacy Practice cont.", block: "law" }
            ]},
            { week: 5, date: "2026-02-11", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Patient Care Lab Exam  Block 2", block: "exam" },
                { time: "13:15", end: "14:45", instructor: "C. Breese", topic: "Pathophysiology: Schizophrenia/Bipolar", block: "psych" }
            ]},
            { week: 5, date: "2026-02-12", classes: [
                { time: "08:30", end: "10:00", instructor: "C. Breese", topic: "Pathophysiology: Schizophrenia/Bipolar", block: "psych" },
                { time: "10:15", end: "11:45", instructor: "C. Breese", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Medicinal Chemistry: Antipsychotics", block: "psych" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Exam 1", block: "exam" }
            ]},
            { week: 5, date: "2026-02-13", classes: [
                { time: "08:30", end: "10:00", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Antipsychotics", block: "psych" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Schizophrenia", block: "psych" }
            ]},
            { week: 6, date: "2026-02-16", classes: [
                { time: "08:30", end: "10:00", instructor: "Long", topic: "Schizophrenia", block: "psych" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Long/Lounsbury-Rivera", topic: "Lab", block: "lab" }
            ]},
            { week: 6, date: "2026-02-17", classes: [
                { time: "08:30", end: "10:00", instructor: "Long", topic: "Lab", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "Bipolar Disorder", block: "psych" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Bipolar Disorder", block: "psych" },
                { time: "15:00", end: "TBD", instructor: "Smith", topic: "Law: Pharmacy Practice cont.", block: "law" }
            ]},
            { week: 6, date: "2026-02-18", classes: [
                { time: "08:30", end: "10:00", instructor: "Long", topic: "Lab", details: "PT Quiz 3", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Drug and Alcohol Abuse", block: "psych" }
            ]},
            { week: 6, date: "2026-02-19", classes: [
                { time: "08:30", end: "10:00", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Drug and Alcohol Abuse", block: "psych" },
                { time: "10:15", end: "11:45", instructor: "Long", topic: "Substance Use Disorder", details: "Alcohol, Opioid, Medical Marijuana, Vaping", block: "psych" },
                { time: "13:15", end: "14:45", instructor: "Long", topic: "Substance Use Disorder", block: "psych" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Pharmacy Practice cont.", block: "law" }
            ]},
            { week: 6, date: "2026-02-20", block: "Block 4: Dermatology/Rheumatology", classes: [
                { time: "08:30", end: "10:00", instructor: "Long", topic: "Lab", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Long/Lounsbury-Rivera", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Burmeister", topic: "Dermatology", block: "derm" }
            ]},
            { week: 7, date: "2026-02-23", classes: [
                { time: "08:30", end: "10:00", instructor: "Burmeister", topic: "Dermatology", block: "derm" },
                { time: "10:15", end: "11:45", instructor: "Lounsbury-Rivera", topic: "Medicinal Chemistry: Acne, Scars, Burns", block: "derm" },
                { time: "13:15", end: "14:45", instructor: "Lounsbury-Rivera", topic: "Pharmacology: Acne, Scars, Burns", block: "derm" }
            ]},
            { week: 7, date: "2026-02-24", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Principles of Drug Action Exam  Block 3", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Dermatologic Conditions", details: "including Alopecia", block: "derm" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Controlled Substances", block: "law" }
            ]},
            { week: 7, date: "2026-02-25", classes: [
                { time: "08:30", end: "10:00", instructor: "A Weldon", topic: "Pathology: Musculoskeletal & Rheumatic", block: "derm" },
                { time: "10:15", end: "11:45", instructor: "A Weldon", topic: "Pathology: Musculoskeletal & Rheumatic", block: "derm" },
                { time: "13:15", end: "14:45", instructor: "A Weldon", topic: "Rheumatology: Immunosuppressants", block: "derm" }
            ]},
            { week: 7, date: "2026-02-26", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Therapeutics Exam  Block 3", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "A Weldon", topic: "Rheumatology: Immunosuppressants", block: "derm" },
                { time: "13:15", end: "14:45", instructor: "A Weldon", topic: "Anti-gout therapies", block: "derm" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Controlled Substances cont.", block: "law" }
            ]},
            { week: 7, date: "2026-02-27", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Patient Care Lab Exam  Block 3", block: "exam" },
                { time: "13:15", end: "14:45", instructor: "A Weldon", topic: "Lab", block: "lab" }
            ]},
            { week: 8, date: "2026-03-02", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "SLE (Systemic Lupus Erythematosus)", block: "derm" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Rheumatoid Arthritis", block: "derm" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Psoriasis/Psoriatic Arthritis", block: "derm" }
            ]},
            { week: 8, date: "2026-03-03", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Gout", details: "PT Quiz 4", block: "derm" },
                { time: "10:15", end: "11:45", instructor: "Reed/A Weldon", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Reed/A Weldon", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Controlled Substances cont.", details: "Quiz 2", block: "law" }
            ]},
            { week: 8, date: "2026-03-04", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Anemia", block: "derm" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" }
            ]},
            { week: 8, date: "2026-03-05", block: "Block 5: Special Populations", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Principles of Drug Action Exam  Block 4", block: "exam" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Sickle Cell Disease", block: "special" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Controlled Substances cont.", block: "law" }
            ]},
            { week: 8, date: "2026-03-06", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Intro to Pediatrics", details: "Growth/Development", block: "special" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Dosage Forms/Drug Delivery", block: "special" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" }
            ]},
            { week: 9, date: "2026-03-09", holiday: "Spring Break" },
            { week: 9, date: "2026-03-10", holiday: "Spring Break" },
            { week: 9, date: "2026-03-11", holiday: "Spring Break" },
            { week: 9, date: "2026-03-12", holiday: "Spring Break" },
            { week: 9, date: "2026-03-13", holiday: "Spring Break" },
            { week: 10, date: "2026-03-16", classes: [
                { time: "08:30", end: "10:00", instructor: "Reed", topic: "Pedi Nutrition and Hydration", block: "special" },
                { time: "10:15", end: "11:45", instructor: "Reed", topic: "Common Pediatric Diseases/Poisonings", block: "special" },
                { time: "13:15", end: "14:45", instructor: "Reed", topic: "Lab", block: "lab" }
            ]},
            { week: 10, date: "2026-03-17", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Ophthalmic Disorders", block: "special" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "Lab", block: "lab" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Intro to Geriatrics/BEERS", details: "Medication Use in the Elderly", block: "special" },
                { time: "15:00", end: "TBD", instructor: "", topic: "Law: Exam 2", block: "exam" }
            ]},
            { week: 10, date: "2026-03-18", classes: [
                { time: "08:30", end: "10:00", instructor: "", topic: "Therapeutics/Patient Care Lab Exam  Block 4", block: "exam" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Falls and Fall Risk/Frailty", block: "special" }
            ]},
            { week: 10, date: "2026-03-19", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Lab", block: "lab" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "Geriatric Syndrome", details: "Swallowing Issues, Pressure Ulcers", block: "special" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Lab", block: "lab" },
                { time: "15:00", end: "TBD", instructor: "Vidal", topic: "Law: Compounding and OTC", block: "law" }
            ]},
            { week: 10, date: "2026-03-20", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "Intro to Critical Care/MODS", block: "special" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "Pain, Agitation, and Delirium", block: "special" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Lab", block: "lab" }
            ]},
            { week: 11, date: "2026-03-23", classes: [
                { time: "08:30", end: "10:00", instructor: "Zumwalt", topic: "ARDS, CNS Traumas, ACLS", block: "special" },
                { time: "10:15", end: "11:45", instructor: "Zumwalt", topic: "End-of-life Care", details: "Pain, dyspnea, constipation, restlessness", block: "special" },
                { time: "13:15", end: "14:45", instructor: "Zumwalt", topic: "Lab", block: "lab" }
            ]},
            { week: 11, date: "2026-03-24", holiday: "Study Day" },
            { week: 11, date: "2026-03-25", classes: [{ time: "08:30", end: "12:00", instructor: "", topic: "Therapeutics Final Exam", block: "exam" }]},
            { week: 11, date: "2026-03-26", classes: [{ time: "08:30", end: "12:00", instructor: "", topic: "Patient Care Lab Final Exam", block: "exam" }]},
            { week: 11, date: "2026-03-27", event: "End of Term for P2s", classes: [
                { time: "15:00", end: "TBD", instructor: "", topic: "Law: Final Exam", block: "exam" }
            ]}
        ];

        let studyMaterials = JSON.parse(localStorage.getItem('studyMaterials')) || {};
        let materialRatings = JSON.parse(localStorage.getItem('materialRatings')) || {};

        const categoryConfig = {
            game: { icon: '', label: 'Games' },
            guide: { icon: '', label: 'Guides' },
            quiz: { icon: '', label: 'Quizzes' },
            notes: { icon: '', label: 'Notes' },
            video: { icon: '', label: 'Videos' },
            other: { icon: '', label: 'Other' }
        };

        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const fullDayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        function formatTime12(t) { const [h,m] = t.split(':'); const hr = parseInt(h); return `${hr % 12 || 12}:${m} ${hr >= 12 ? 'PM' : 'AM'}`; }
        function parseTime(d, t) { const [h, m] = t.split(':'); const dt = new Date(d + 'T00:00:00'); dt.setHours(parseInt(h), parseInt(m), 0, 0); return dt; }
        function getDateString(d) { return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`; }
        function formatDate(ds) { const d = new Date(ds + 'T00:00:00'); return `${monthNames[d.getMonth()]} ${d.getDate()}`; }
        function getDayName(ds) { return fullDayNames[new Date(ds + 'T00:00:00').getDay()]; }
        function getTimeUntil(t, n) { const diff = t - n; if (diff <= 0) return null; const mins = Math.floor(diff / 60000); const hrs = Math.floor(mins / 60); return hrs > 0 ? `${hrs}h ${mins % 60}m` : `${mins}m`; }

        function getMaterialKey(ds, i) { return `${ds}_${i}`; }
        function getRating(ds, i) {
            const r = materialRatings[getMaterialKey(ds, i)] || [];
            if (!r.length) return { avg: 0, count: 0 };
            return { avg: Math.round(r.reduce((a,b) => a+b, 0) / r.length * 10) / 10, count: r.length };
        }
        function addRating(ds, i, rating) {
            const k = getMaterialKey(ds, i);
            if (!materialRatings[k]) materialRatings[k] = [];
            materialRatings[k].push(rating);
            localStorage.setItem('materialRatings', JSON.stringify(materialRatings));
            generateCalendar();
        }

        function getSortedMaterials(ds, cat) {
            const m = studyMaterials[ds] || [];
            const f = cat ? m.filter(x => x.category === cat) : m;
            return f.map((x, i) => ({ ...x, originalIdx: m.indexOf(x), rating: getRating(ds, m.indexOf(x)) }))
                    .sort((a, b) => b.rating.avg - a.rating.avg);
        }

        function getCategoriesWithMaterials(ds) {
            const m = studyMaterials[ds] || [], cats = {};
            m.forEach(x => { cats[x.category] = (cats[x.category] || 0) + 1; });
            return cats;
        }

        function generateMaterialsSection(ds, ci) {
            const cats = getCategoriesWithMaterials(ds), keys = Object.keys(cats);
            if (!keys.length) return '<div class="study-materials"><div style="padding:12px;text-align:center;color:var(--color-text-muted);font-size:0.75rem;">No study materials yet</div></div>';
            const first = keys[0];
            const bubbles = keys.map(c => `<div class="material-bubble ${c === first ? 'active' : ''}" data-category="${c}" onclick="filterMaterials('${ds}','${c}',${ci})">${categoryConfig[c]?.icon || ''} ${categoryConfig[c]?.label || c}<span class="count">${cats[c]}</span></div>`).join('');
            const items = getSortedMaterials(ds, first).map(m => generateMaterialItem(m, ds)).join('');
            return `<div class="study-materials" id="materials-${ds}-${ci}"><div class="materials-header"><h4> Study Materials</h4></div><div class="material-bubbles">${bubbles}</div><div class="materials-list" id="materials-list-${ds}-${ci}">${items}</div></div>`;
        }

        function generateMaterialItem(m, ds) {
            const icon = categoryConfig[m.category]?.icon || '', r = m.rating || getRating(ds, m.originalIdx);
            const stars = Array.from({length: 5}, (_, i) => `<span class="star ${i < Math.round(r.avg) ? 'filled' : ''}" onmouseover="hoverStar(this,${i+1})" onmouseout="unhoverStars(this)" onclick="rateMaterial('${ds}',${m.originalIdx},${i+1})"></span>`).join('');
            return `<div class="material-item" onclick="${m.type === 'link' ? `window.open('${m.url}','_blank')` : `downloadMaterial('${ds}',${m.originalIdx})`}"><div class="material-icon ${m.category}">${icon}</div><div class="material-info"><div class="material-name">${m.name}</div><div class="material-meta">${m.description || (m.type === 'link' ? 'Link' : m.fileName || 'File')}</div></div><div class="star-rating" onclick="event.stopPropagation()">${stars}${r.count > 0 ? `<span class="avg-rating">${r.avg}</span>` : ''}</div></div>`;
        }

        function hoverStar(el, r) { el.parentElement.querySelectorAll('.star').forEach((s, i) => s.classList.toggle('hovered', i < r)); }
        function unhoverStars(el) { el.parentElement.querySelectorAll('.star').forEach(s => s.classList.remove('hovered')); }
        function rateMaterial(ds, i, r) { addRating(ds, i, r); }

        function filterMaterials(ds, cat, ci) {
            const cont = document.getElementById(`materials-${ds}-${ci}`);
            if (!cont) return;
            cont.querySelectorAll('.material-bubble').forEach(b => b.classList.toggle('active', b.dataset.category === cat));
            document.getElementById(`materials-list-${ds}-${ci}`).innerHTML = getSortedMaterials(ds, cat).map(m => generateMaterialItem(m, ds)).join('');
        }

        function downloadMaterial(ds, i) {
            const m = studyMaterials[ds]?.[i];
            if (m?.dataUrl) { const a = document.createElement('a'); a.href = m.dataUrl; a.download = m.fileName || 'download'; document.body.appendChild(a); a.click(); document.body.removeChild(a); }
        }

        function generateCalendar() {
            const cal = document.getElementById('calendar'), now = getCentralTime(), today = getDateString(now);
            let html = '', cw = 0, cb = '';
            const collapsedWeeks = JSON.parse(localStorage.getItem('collapsedWeeks') || '[]');

            for (const day of schedule) {
                if (day.week !== cw) {
                    if (cw > 0) html += '</div></div>'; // Close previous week-content and week-container
                    cw = day.week;
                    const isCollapsed = collapsedWeeks.includes(cw);
                    html += `<div class="week-container${isCollapsed ? ' collapsed' : ''}" data-week="${cw}">`;
                    html += `<div class="week-header" onclick="toggleWeek(${cw})"><span>Week ${cw}</span><span class="week-toggle"></span></div>`;
                    html += '<div class="week-content">';
                }
                if (day.block && day.block !== cb) { cb = day.block; html += `<div class="block-header">${cb}</div>`; }

                const ds = day.date, isToday = ds === today, isPast = new Date(ds + 'T23:59:59') < now, isHoliday = !!day.holiday, hasExam = day.classes?.some(c => c.block === 'exam'), hasEvent = !!day.event;
                let cardClass = 'day-card'; if (isToday) cardClass += ' today'; if (isPast && !isToday) cardClass += ' past';

                html += `<div class="${cardClass}" id="day-${ds}"><div class="day-header"><span class="day-name">${getDayName(ds)}, ${formatDate(ds)}</span><span class="badges">${isToday ? '<span class="badge today-badge">TODAY</span>' : ''}${hasExam ? '<span class="badge exam-badge">EXAM</span>' : ''}${hasEvent ? '<span class="badge money-badge"></span>' : ''}</span></div>`;

                if (isHoliday) {
                    html += `<div class="holiday-notice"> ${day.holiday}</div>`;
                } else if (day.classes?.length) {
                    if (day.event) html += `<div class="event-banner">${day.event}</div>`;
                    html += '<div class="classes-list">';
                    day.classes.forEach((cl, idx) => {
                        const st = parseTime(ds, cl.time), et = cl.end === 'TBD' ? parseTime(ds, '23:59') : parseTime(ds, cl.end);
                        let status = 'upcoming'; if (isPast || now > et) status = 'completed'; else if (now >= st && now <= et) status = 'in-progress';
                        const countdown = status === 'upcoming' && isToday ? getTimeUntil(st, now) : null;
                        const hasMaterials = (studyMaterials[ds]?.length || 0) > 0;
                        const isCurrent = status === 'in-progress';

                        html += `<div class="class-item ${status === 'completed' ? 'completed' : ''} ${isCurrent ? 'current current-indicator' : ''}" data-block="${cl.block}" id="class-${ds}-${idx}">
                            <div class="class-main" onclick="toggleClass('${ds}',${idx})">
                                <div class="class-time"><div class="time-range">${formatTime12(cl.time)} - ${cl.end === 'TBD' ? 'TBD' : formatTime12(cl.end)}</div>${countdown ? `<div class="countdown">in ${countdown}</div>` : ''}</div>
                                <div class="class-info"><div class="class-name">${cl.topic}</div><div class="class-details">${cl.instructor || ''}${cl.details ? '  ' + cl.details : ''}${hasMaterials && idx === 0 ? '  ' : ''}</div></div>
                                <span class="class-status ${status}">${status === 'in-progress' ? ' LIVE' : status}</span>
                                <span class="expand-icon"></span>
                            </div>
                            ${idx === 0 ? generateMaterialsSection(ds, idx) : ''}
                        </div>`;
                    });
                    html += '</div>';
                }
                html += '</div>';
            }
            if (cw > 0) html += '</div></div>'; // Close last week-content and week-container
            cal.innerHTML = html;
        }

        function toggleWeek(weekNum) {
            const container = document.querySelector(`.week-container[data-week="${weekNum}"]`);
            if (!container) return;
            container.classList.toggle('collapsed');
            // Save state to localStorage
            let collapsed = JSON.parse(localStorage.getItem('collapsedWeeks') || '[]');
            if (container.classList.contains('collapsed')) {
                if (!collapsed.includes(weekNum)) collapsed.push(weekNum);
            } else {
                collapsed = collapsed.filter(w => w !== weekNum);
            }
            localStorage.setItem('collapsedWeeks', JSON.stringify(collapsed));
        }

        function toggleClass(ds, i) { document.getElementById(`class-${ds}-${i}`)?.classList.toggle('expanded'); }

        function updateStatus() {
            const now = getCentralTime(), today = getDateString(now), ts = schedule.find(d => d.date === today);
            const sb = document.getElementById('status-badge'), si = document.getElementById('status-info'), bar = document.getElementById('status-bar');

            if (ts?.holiday) { bar.className = 'status-bar'; sb.className = 'status-badge done'; sb.textContent = 'OFF'; si.innerHTML = ` ${ts.holiday}`; return; }

            if (ts?.classes) {
                let cur = null, nxt = null;
                for (const cl of ts.classes) { const st = parseTime(today, cl.time), et = cl.end === 'TBD' ? parseTime(today, '23:59') : parseTime(today, cl.end); if (now >= st && now <= et) { cur = cl; break; } else if (now < st && !nxt) { nxt = cl; } }

                if (cur) {
                    const et = parseTime(today, cur.end), rem = getTimeUntil(et, now);
                    bar.className = 'status-bar in-class'; sb.className = 'status-badge in-progress'; sb.textContent = ' LIVE';
                    si.innerHTML = `<strong>${cur.topic}</strong>  ${rem ? rem + ' left' : 'ending soon'}`;
                } else if (nxt) {
                    const st = parseTime(today, nxt.time);
                    bar.className = 'status-bar'; sb.className = 'status-badge upcoming'; sb.textContent = 'NEXT';
                    si.innerHTML = `<strong>${nxt.topic}</strong>  in ${getTimeUntil(st, now)}`;
                } else {
                    bar.className = 'status-bar'; sb.className = 'status-badge done'; sb.textContent = 'DONE';
                    si.innerHTML = 'All classes completed today! ';
                }
            } else {
                bar.className = 'status-bar'; sb.className = 'status-badge done'; sb.textContent = 'FREE';
                si.innerHTML = 'No classes scheduled today';
            }
        }

        function updateClock() {
            const now = getCentralTime();
            document.getElementById('live-time').textContent = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit' }) + ' CT';
            document.getElementById('live-date').textContent = `${monthNames[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
        }

        function updateFinalCountdown() {
            const now = getCentralTime();
            const todayStr = getDateString(now);

            // Find all exams from the schedule
            const exams = [];
            schedule.forEach(day => {
                if (day.classes) {
                    day.classes.forEach(cl => {
                        if (cl.block === 'exam') {
                            exams.push({ date: day.date, topic: cl.topic });
                        }
                    });
                }
            });

            // Sort exams by date
            exams.sort((a, b) => a.date.localeCompare(b.date));

            // Find the next upcoming exam
            const upcomingExams = exams.filter(e => e.date >= todayStr);
            const nextExam = upcomingExams[0];

            // Last final is Patient Care Lab Final Exam on March 26, 2026
            const lastFinal = new Date('2026-03-26T12:00:00');
            const lastDiff = lastFinal - now;

            // Update Next Final countdown
            const nextCountdown = document.getElementById('next-final-countdown');
            if (nextExam) {
                const nextDate = new Date(nextExam.date + 'T12:00:00');
                const nextDiff = nextDate - now;
                const nextDays = Math.ceil(nextDiff / (1000 * 60 * 60 * 24));
                document.getElementById('next-final-days').textContent = nextDays;
                nextCountdown.querySelector('.countdown-label').textContent = nextDays === 1 ? 'Day' : 'Days';
            } else {
                nextCountdown.innerHTML = '<span class="countdown-icon"></span><span class="countdown-text">All Exams Done!</span>';
            }

            // Update Last Final countdown
            const lastCountdown = document.getElementById('final-countdown');
            if (lastDiff <= 0) {
                lastCountdown.innerHTML = '<span class="countdown-icon"></span><span class="countdown-text">Finals Complete!</span>';
                return;
            }

            const lastDays = Math.ceil(lastDiff / (1000 * 60 * 60 * 24));
            document.getElementById('final-days').textContent = lastDays;
            lastCountdown.querySelector('.countdown-label').textContent = lastDays === 1 ? 'Day' : 'Days';
        }

        function scrollToNow() {
            const now = getCentralTime(), today = getDateString(now);
            const cur = document.querySelector('.class-item.current');
            if (cur) { cur.scrollIntoView({ behavior: 'smooth', block: 'center' }); return; }
            const todayEl = document.getElementById(`day-${today}`);
            if (todayEl) { todayEl.scrollIntoView({ behavior: 'smooth', block: 'start' }); return; }
            for (const d of schedule) { if (new Date(d.date + 'T00:00:00') >= now) { const el = document.getElementById(`day-${d.date}`); if (el) { el.scrollIntoView({ behavior: 'smooth', block: 'start' }); break; } } }
        }

        function scrollToTop() { document.getElementById('calendar-container').scrollTo({ top: 0, behavior: 'smooth' }); }

        function updateLivePosition() {
            const now = getCentralTime(), today = getDateString(now), ts = schedule.find(d => d.date === today);
            if (!ts?.classes) return;
            ts.classes.forEach((cl, idx) => {
                const el = document.getElementById(`class-${today}-${idx}`); if (!el) return;
                const st = parseTime(today, cl.time), et = cl.end === 'TBD' ? parseTime(today, '23:59') : parseTime(today, cl.end);
                const isCur = now >= st && now <= et, isComp = now > et;
                el.classList.toggle('current', isCur); el.classList.toggle('current-indicator', isCur); el.classList.toggle('completed', isComp);
                const cd = el.querySelector('.countdown'); if (cd && !isComp && !isCur) { const t = getTimeUntil(st, now); cd.textContent = t ? `in ${t}` : ''; }
                const se = el.querySelector('.class-status');
                if (se) { if (isCur) { se.className = 'class-status in-progress'; se.textContent = ' LIVE'; } else if (isComp) { se.className = 'class-status completed'; se.textContent = 'completed'; } else { se.className = 'class-status upcoming'; se.textContent = 'upcoming'; } }
            });
        }

        // Overview Functions
        function showOverview() {
            generateOverview();
            document.getElementById('overview-modal').classList.add('active');
        }

        function hideOverview() {
            document.getElementById('overview-modal').classList.remove('active');
        }

        function generateOverview() {
            const now = getCentralTime(), today = getDateString(now);
            const weeks = {};
            schedule.forEach(d => { if (!weeks[d.week]) weeks[d.week] = []; weeks[d.week].push(d); });

            let html = '';
            Object.entries(weeks).forEach(([wk, days]) => {
                html += `<div class="overview-week"><h3>Week ${wk}</h3>`;
                days.forEach(d => {
                    const isToday = d.date === today, isPast = new Date(d.date + 'T23:59:59') < now;
                    let cls = 'overview-day'; if (isToday) cls += ' today'; if (isPast && !isToday) cls += ' past';
                    html += `<div class="${cls}"><div class="overview-day-name">${dayNames[new Date(d.date + 'T00:00:00').getDay()]} ${formatDate(d.date)}${isToday ? ' (TODAY)' : ''}</div>`;
                    html += '<div class="overview-topics">';
                    if (d.holiday) { html += `<span class="overview-topic holiday"> ${d.holiday}</span>`; }
                    else if (d.classes) {
                        const unique = [...new Set(d.classes.map(c => c.topic))];
                        unique.forEach(t => {
                            const isExam = t.toLowerCase().includes('exam');
                            html += `<span class="overview-topic ${isExam ? 'exam' : ''}">${t}</span>`;
                        });
                    }
                    html += '</div></div>';
                });
                html += '</div>';
            });
            document.getElementById('overview-grid').innerHTML = html;
        }

        // Exams Functions
        function showExams() {
            generateExams();
            document.getElementById('exams-modal').classList.add('active');
        }

        function hideExams() {
            document.getElementById('exams-modal').classList.remove('active');
        }

        function getExamType(topic) {
            const t = topic.toLowerCase();
            if (t.includes('final')) return { type: 'final', label: 'Final', badge: 'final' };
            if (t.includes('principles of drug action') || t.includes('pda')) return { type: 'pda', label: 'PDA', badge: 'pda' };
            if (t.includes('therapeutics')) return { type: 'ther', label: 'Therapeutics', badge: 'ther' };
            if (t.includes('patient care lab') || t.includes('pcl')) return { type: 'pcl', label: 'PCL', badge: 'pcl' };
            return { type: 'exam', label: 'Exam', badge: 'pda' };
        }

        function generateExams() {
            const now = getCentralTime(), today = getDateString(now);
            const exams = [], quizzes = [];

            // Extract all exams and quizzes from schedule
            schedule.forEach(day => {
                if (!day.classes) return;
                day.classes.forEach(cl => {
                    // Check for exams
                    if (cl.block === 'exam') {
                        exams.push({
                            date: day.date,
                            topic: cl.topic,
                            time: cl.time,
                            end: cl.end,
                            examType: getExamType(cl.topic)
                        });
                    }
                    // Check for quizzes in details
                    if (cl.details && cl.details.toLowerCase().includes('quiz')) {
                        const quizMatch = cl.details.match(/PT Quiz (\d+)/i);
                        quizzes.push({
                            date: day.date,
                            topic: quizMatch ? `PT Quiz ${quizMatch[1]}` : 'Quiz',
                            relatedTopic: cl.topic,
                            time: cl.time,
                            end: cl.end
                        });
                    }
                });
            });

            // Calculate stats
            const totalExams = exams.length;
            const completedExams = exams.filter(e => new Date(e.date + 'T23:59:59') < now).length;
            const upcomingExams = totalExams - completedExams;
            const nextExam = exams.find(e => new Date(e.date + 'T00:00:00') >= now);

            let html = '';

            // Stats section
            html += '<div class="exam-stats">';
            html += `<div class="stat-card"><div class="number">${upcomingExams}</div><div class="label">Upcoming Exams</div></div>`;
            html += `<div class="stat-card"><div class="number">${completedExams}</div><div class="label">Completed</div></div>`;
            html += `<div class="stat-card"><div class="number">${quizzes.length}</div><div class="label">PT Quizzes</div></div>`;
            if (nextExam) {
                const daysUntil = Math.ceil((new Date(nextExam.date + 'T00:00:00') - now) / (1000 * 60 * 60 * 24));
                html += `<div class="stat-card"><div class="number">${daysUntil > 0 ? daysUntil : 'Today!'}</div><div class="label">${daysUntil > 0 ? 'Days to Next Exam' : 'Exam Day'}</div></div>`;
            }
            html += '</div>';

            // Upcoming Exams Section
            const upcomingExamsList = exams.filter(e => new Date(e.date + 'T23:59:59') >= now);
            if (upcomingExamsList.length > 0) {
                html += '<div class="exam-section">';
                html += '<div class="exam-section-title"><span class="icon"></span> Upcoming Exams</div>';
                html += '<div class="exam-list">';
                upcomingExamsList.forEach(exam => {
                    const isToday = exam.date === today;
                    const daysUntil = Math.ceil((new Date(exam.date + 'T00:00:00') - now) / (1000 * 60 * 60 * 24));
                    const countdown = isToday ? 'TODAY' : daysUntil === 1 ? 'Tomorrow' : `${daysUntil} days`;
                    html += `<div class="exam-swipe-container">
                        <div class="cooked-reveal" onclick="openCookedQuiz('${exam.topic.replace(/'/g, "\\'")}')">
                            <span class="cooked-fire"></span>
                            <span class="cooked-fire"></span>
                            <span class="cooked-fire"></span>
                            <span class="cooked-text">How cooked am I?</span>
                        </div>
                        <div class="exam-item exam-item-draggable ${isToday ? 'today' : ''}"
                             onmousedown="startDrag(event, this)"
                             ontouchstart="startDrag(event, this)">
                            <div class="exam-date">
                                <div class="day">${dayNames[new Date(exam.date + 'T00:00:00').getDay()]}</div>
                                <div class="date">${formatDate(exam.date)}</div>
                                <div class="countdown">${countdown}</div>
                            </div>
                            <div class="exam-info">
                                <div class="exam-name">${exam.topic}</div>
                                <div class="exam-details">${formatTime12(exam.time)} - ${exam.end === 'TBD' ? 'TBD' : formatTime12(exam.end)}</div>
                            </div>
                            <span class="exam-type-badge ${exam.examType.badge}">${exam.examType.label}</span>
                            <span class="swipe-hint"><span class="swipe-hint-arrow"></span> swipe</span>
                        </div>
                    </div>`;
                });
                html += '</div></div>';

                // Law Practice Link - show if there are any law exams
                const hasLawExams = upcomingExamsList.some(e => e.topic.toLowerCase().includes('law'));
                if (hasLawExams) {
                    html += `<a href="https://pharmlaw.vercel.app" target="_blank" class="law-practice-link">
                        <span class="icon"></span>
                        <span class="text">
                            <span class="main">Practice Pharmacy Law</span>
                            <span class="sub">AI-powered MPJE study trainer</span>
                        </span>
                        <span class="arrow"></span>
                    </a>`;
                }
            }

            // PT Quizzes Section
            const upcomingQuizzes = quizzes.filter(q => new Date(q.date + 'T23:59:59') >= now);
            const completedQuizzes = quizzes.filter(q => new Date(q.date + 'T23:59:59') < now);

            if (upcomingQuizzes.length > 0) {
                html += '<div class="exam-section">';
                html += '<div class="exam-section-title"><span class="icon"></span> Upcoming PT Quizzes</div>';
                html += '<div class="exam-list">';
                upcomingQuizzes.forEach(quiz => {
                    const isToday = quiz.date === today;
                    const daysUntil = Math.ceil((new Date(quiz.date + 'T00:00:00') - now) / (1000 * 60 * 60 * 24));
                    const countdown = isToday ? 'TODAY' : daysUntil === 1 ? 'Tomorrow' : `${daysUntil} days`;
                    html += `<div class="exam-item quiz ${isToday ? 'today' : ''}">
                        <div class="exam-date">
                            <div class="day">${dayNames[new Date(quiz.date + 'T00:00:00').getDay()]}</div>
                            <div class="date">${formatDate(quiz.date)}</div>
                            <div class="countdown">${countdown}</div>
                        </div>
                        <div class="exam-info">
                            <div class="exam-name">${quiz.topic}</div>
                            <div class="exam-details">During: ${quiz.relatedTopic}</div>
                        </div>
                        <span class="exam-type-badge quiz">Quiz</span>
                    </div>`;
                });
                html += '</div></div>';
            }

            // Completed Exams Section
            const completedExamsList = exams.filter(e => new Date(e.date + 'T23:59:59') < now);
            if (completedExamsList.length > 0) {
                html += '<div class="exam-section">';
                html += '<div class="exam-section-title"><span class="icon"></span> Completed Exams</div>';
                html += '<div class="exam-list">';
                completedExamsList.forEach(exam => {
                    html += `<div class="exam-item completed">
                        <div class="exam-date">
                            <div class="day">${dayNames[new Date(exam.date + 'T00:00:00').getDay()]}</div>
                            <div class="date">${formatDate(exam.date)}</div>
                            <div class="countdown">Done</div>
                        </div>
                        <div class="exam-info">
                            <div class="exam-name">${exam.topic}</div>
                            <div class="exam-details">${formatTime12(exam.time)} - ${formatTime12(exam.end)}</div>
                        </div>
                        <span class="exam-type-badge ${exam.examType.badge}">${exam.examType.label}</span>
                    </div>`;
                });
                html += '</div></div>';
            }

            // Completed Quizzes Section
            if (completedQuizzes.length > 0) {
                html += '<div class="exam-section">';
                html += '<div class="exam-section-title"><span class="icon"></span> Completed PT Quizzes</div>';
                html += '<div class="exam-list">';
                completedQuizzes.forEach(quiz => {
                    html += `<div class="exam-item quiz completed">
                        <div class="exam-date">
                            <div class="day">${dayNames[new Date(quiz.date + 'T00:00:00').getDay()]}</div>
                            <div class="date">${formatDate(quiz.date)}</div>
                            <div class="countdown">Done</div>
                        </div>
                        <div class="exam-info">
                            <div class="exam-name">${quiz.topic}</div>
                            <div class="exam-details">Topic: ${quiz.relatedTopic}</div>
                        </div>
                        <span class="exam-type-badge quiz">Quiz</span>
                    </div>`;
                });
                html += '</div></div>';
            }

            document.getElementById('exams-content').innerHTML = html;
        }

        // "Am I Cooked?" Quiz Data - Add questions for each exam topic
        // Question Bank for "How Cooked Am I?" Quiz
        const examQuestionBanks = {
            "Principles of Drug Action Exam  Block 1": {
                title: "Block 1: Principles of Drug Action",
                hints: [
                    "Questions coming soon!"
                ],
                questions: [
                    {
                        type: "mc",
                        q: "Check back later for PDA Block 1 questions!",
                        options: ["Check back later", "Coming soon", "Stay tuned", "Questions pending"],
                        answer: 0
                    }
                ]
            },
            "Therapeutics Exam  Block 1": {
                title: "Block 1: Therapeutics (PD/MS/ET/RLS)",
                hints: [
                    "OLD / COG IMPAIRED  LEVODOPA",
                    "YOUNG / NO COG  DOPAMINE AGONIST",
                    "Check iron levels first in RLS",
                    "Propranolol for Essential Tremor (unless HF)",
                    "OCRELIZUMAB = Only FDA-approved for PPMS",
                    "True MS relapse: 24h symptoms + 30 days since last",
                    "Steroids shorten relapse, DON'T prevent disability",
                    "Teriflunomide = Cat X, 2yr washout without procedure",
                    "Natalizumab = Highest PML risk (JCV antibody monitoring)",
                    "Ofatumumab = Anti-CD20 self-injectable (weekly x3, then monthly)",
                    "IFNs + Glatiramer = Lower efficacy but BEST safety",
                    "DMF flushing  non-enteric ASA 325mg 30min before"
                ],
                questions: [
                    // ========== PARKINSON'S DISEASE - Multiple Choice (7) ==========
                    {
                        type: "mc",
                        q: "A 66-year-old patient newly diagnosed with Parkinson disease has mild functional impairment, no cognitive issues, and tremor is not the predominant symptom. Which is the best initial therapy?",
                        options: ["Carbidopa/levodopa", "Pramipexole", "Selegiline", "Benztropine"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which adverse effect is MOST associated with dopamine agonists compared with levodopa?",
                        options: ["Orthostatic hypotension", "Impulse control disorders", "Dyskinesia", "Nausea"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "A patient develops painful sustained muscle contractions in the early morning before the first levodopa dose. What is the best description of this complication?",
                        options: ["Peak-dose dyskinesia", "Wearing-off phenomenon", "Off-period dystonia", "Freezing of gait"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "A 62-year-old patient with Parkinson disease is started on pramipexole. Two months later, his spouse reports new compulsive gambling behavior. Which mechanism best explains this adverse effect?",
                        options: ["NMDA receptor antagonism", "Dopamine receptor overstimulation", "Anticholinergic effects", "Inhibition of dopamine metabolism"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which medication is CONTRAINDICATED with selegiline due to risk of serotonin syndrome?",
                        options: ["Acetaminophen", "Sertraline", "Meperidine", "Ibuprofen"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Why is carbidopa combined with levodopa in Parkinson disease treatment?",
                        options: ["To increase dopamine release in the CNS", "To prevent levodopa from crossing the BBB", "To reduce peripheral conversion of levodopa", "To treat levodopa-induced dyskinesia"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which patient is the BEST candidate for dopamine agonist monotherapy as initial treatment?",
                        options: ["78-year-old with hallucinations", "70-year-old with cognitive impairment", "60-year-old with mild PD and intact cognition", "82-year-old with orthostatic hypotension"],
                        answer: 2
                    },

                    // ========== PARKINSON'S DISEASE - Matching (5) ==========
                    {
                        type: "match",
                        q: "Match the medication class to its PRIMARY role:",
                        pairs: [
                            { left: "Amantadine", right: "Treatment of levodopa-induced dyskinesia" },
                            { left: "MAO-B inhibitors", right: "Monotherapy option for mild PD" },
                            { left: "COMT inhibitors", right: "Adjunct to reduce OFF time" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the symptom to the MOST appropriate pharmacologic approach:",
                        pairs: [
                            { left: "Tremor in young patient", right: "Anticholinergic" },
                            { left: "Peak-dose dyskinesia", right: "Amantadine" },
                            { left: "Wearing-off", right: "Add COMT inhibitor" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the medication to the KEY safety concern:",
                        pairs: [
                            { left: "Tolcapone", right: "Hepatotoxicity" },
                            { left: "Dopamine agonists", right: "Impulse control disorders" },
                            { left: "Anticholinergics", right: "Cognitive impairment" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the complication with the BEST management strategy:",
                        pairs: [
                            { left: "Peak-dose dyskinesia", right: "Add amantadine" },
                            { left: "Off-period dystonia", right: "Add long-acting bedtime levodopa" },
                            { left: "Wearing-off", right: "Add COMT inhibitor" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the medication with its PRIMARY adverse effect:",
                        pairs: [
                            { left: "Amantadine", right: "Livedo reticularis" },
                            { left: "Dopamine agonists", right: "Impulse control disorders" },
                            { left: "Tolcapone", right: "Hepatotoxicity" }
                        ]
                    },

                    // ========== PARKINSON'S DISEASE - Select All (4) ==========
                    {
                        type: "select",
                        q: "Which of the following medications should generally be AVOIDED in patients with Parkinson disease due to worsening motor symptoms? (Select ALL that apply)",
                        options: ["Metoclopramide", "Prochlorperazine", "Quetiapine", "Haloperidol", "Ondansetron"],
                        answer: [0, 1, 3]
                    },
                    {
                        type: "select",
                        q: "Which of the following are appropriate management strategies for peak-dose dyskinesia? (Select ALL that apply)",
                        options: ["Reduce individual levodopa doses", "Increase dosing frequency", "Add amantadine", "Add COMT inhibitor", "Discontinue MAO-B inhibitor"],
                        answer: [0, 1, 2]
                    },
                    {
                        type: "select",
                        q: "Which of the following are recognized non-motor complications of Parkinson disease? (Select ALL that apply)",
                        options: ["Orthostatic hypotension", "Depression", "Hallucinations", "Hyperthyroidism", "REM sleep behavior disorder"],
                        answer: [0, 1, 2, 4]
                    },
                    {
                        type: "select",
                        q: "Which of the following medication classes can POTENTIATE levodopa effects and increase dyskinesia risk? (Select ALL that apply)",
                        options: ["COMT inhibitors", "MAO-B inhibitors", "Anticholinergics", "Dopamine agonists", "Beta blockers"],
                        answer: [0, 1, 3]
                    },

                    // ========== ESSENTIAL TREMOR & RLS - Multiple Choice (3) ==========
                    {
                        type: "mc",
                        q: "A 67-year-old woman presents with a bilateral hand tremor that is worse when holding objects and writing. The tremor improves after drinking alcohol. There is no rigidity or bradykinesia. Which medication is the best initial therapy?",
                        options: ["Carbidopa/levodopa", "Propranolol", "Pramipexole", "Benztropine"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "A patient with essential tremor also has heart failure with reduced ejection fraction (EF 30%). Which medication is the most appropriate first-line option?",
                        options: ["Propranolol", "Metoprolol", "Primidone", "Topiramate"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "A 70-year-old patient reports an urge to move her legs associated with unpleasant sensations that are worse at night and at rest, and improve with movement. Labs reveal iron deficiency. Which is the most appropriate initial intervention?",
                        options: ["Start pramipexole", "Start gabapentin enacarbil", "Start carbidopa/levodopa", "Correct iron deficiency"],
                        answer: 3
                    },

                    // ========== ESSENTIAL TREMOR & RLS - Matching (1) ==========
                    {
                        type: "match",
                        q: "Match the disease with its KEY distinguishing feature:",
                        pairs: [
                            { left: "Parkinson disease", right: "Bradykinesia required for diagnosis" },
                            { left: "Essential tremor", right: "Improves with alcohol" },
                            { left: "Restless leg syndrome", right: "Urge to move legs relieved by movement" }
                        ]
                    },

                    // ========== ESSENTIAL TREMOR & RLS - Select All (1) ==========
                    {
                        type: "select",
                        q: "Which of the following statements about Essential Tremor are TRUE? (Select ALL that apply)",
                        options: ["Tremor is typically worse at rest", "Tremor is usually bilateral and symmetric", "Responds to propranolol or primidone", "Improves with levodopa", "Head tremor ('yes-yes' or 'no-no') may occur"],
                        answer: [1, 2, 4]
                    },

                    // ========== MULTIPLE SCLEROSIS - Multiple Choice (15) ==========
                    {
                        type: "mc",
                        q: "A 55-year-old is diagnosed with primary progressive MS (PPMS). Which DMT is specifically highlighted as the only FDA-approved agent for PPMS?",
                        options: ["Natalizumab", "Ocrelizumab", "Fingolimod", "Ofatumumab"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which scenario best meets the definition of a true MS exacerbation appropriate to consider treatment (vs pseudo-exacerbation)?",
                        options: ["Symptoms for 12 hours, last relapse 2 months ago", "Symptoms for 48 hours, last relapse 10 days ago", "Symptoms for 30 hours, last relapse 45 days ago", "Symptoms for 20 hours, last relapse 45 days ago"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "A patient has a severe relapse with functional decline. Which regimen is most consistent with the recommendation?",
                        options: ["Prednisone 10 mg daily x 5 days", "IV methylprednisolone 5001000 mg/day x 35 days", "IM methylprednisolone 40 mg once", "Dexamethasone 1 mg twice daily x 10 days"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which statement about corticosteroids for MS relapses is TRUE?",
                        options: ["Steroids prevent future relapses when used monthly", "Steroids reduce long-term disability progression when used early", "Steroids shorten relapse duration/severity but do not alter long-term disability accumulation", "Steroids should be used for relapse prevention instead of DMTs"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which DMTs are described as traditional injectables with lower efficacy/slower onset but best safety profile?",
                        options: ["Interferons and glatiramer acetate", "Natalizumab and ocrelizumab", "Fingolimod and dimethyl fumarate", "Cladribine and alemtuzumab"],
                        answer: 0
                    },
                    {
                        type: "mc",
                        q: "Which self-injectable DMT is an anti-CD20 therapy and is noted as an exception because it 'behaves like infusion therapies'?",
                        options: ["Glatiramer acetate", "Interferon beta-1a", "Ofatumumab", "Peginterferon beta-1a"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which of the following is the correct Kesimpta (ofatumumab) dosing pattern?",
                        options: ["20 mg SQ monthly starting immediately", "20 mg SQ weekly at weeks 0, 1, 2; then monthly starting week 4", "20 mg SQ daily for 14 days, then stop", "30 mcg IM weekly"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "For interferon beta products, which monitoring plan matches the recommended schedule?",
                        options: ["CBC only at baseline, then annually", "LFTs monthly indefinitely, no CBC needed", "CBC/platelets/LFTs baseline, 1 month, q3 months x 1 year, then q6 months (plus suicide risk monitoring)", "No monitoring needed unless symptoms occur"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "A patient on glatiramer acetate reports facial flushing, palpitations, chest discomfort, shortness of breath, and anxiety starting minutes after injection and resolving within ~30 minutes. Best interpretation?",
                        options: ["This is anaphylaxisadminister epinephrine immediately", "This is the benign post-injection reaction; reassure/counsel and monitor", "This indicates liver failurestop therapy", "This is PMLurgent MRI needed"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which oral DMT is explicitly noted as having a pregnancy Category X concern and may require a washout procedure?",
                        options: ["Dimethyl fumarate", "Teriflunomide", "Fingolimod", "Cladribine"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "A patient taking teriflunomide wants to become pregnant soon. What is the best counseling point?",
                        options: ["Stop teriflunomide; no further steps needed because it clears in ~1 week", "Stop teriflunomide; without washout it may take up to 2 years to reach acceptable plasma levels", "Continue teriflunomide through pregnancy because relapse risk decreases during pregnancy", "Switch to natalizumab immediately and give a live vaccine booster first"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which counseling recommendation is specifically highlighted for dimethyl fumarateassociated flushing?",
                        options: ["Take on an empty stomach to improve absorption", "Premedicate with non-enteric aspirin 325 mg 30 minutes before the dose", "Crush and sprinkle capsule contents on food", "Avoid all food with dimethyl fumarate to reduce GI upset"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which oral DMT is the only one with a pediatric indication (10 years old) among the S1P modulators?",
                        options: ["Siponimod", "Ozanimod", "Fingolimod", "Ponesimod"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which statement best reflects the 'place in therapy' concept for natalizumab?",
                        options: ["Best first-line for all mild RRMS due to lowest risk", "Reserved for highly active disease; risk/benefit must be considered case-by-case", "Used only for PPMS", "Used only for CIS and never RRMS"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Discontinuation of a DMT may be considered in which scenario?",
                        options: ["RRMS patient with no relapse for 3 months", "SPMS patient who is not ambulatory (EDSS 7) and has no ongoing relapses/MRI activity for 2 years", "Any patient who dislikes injections", "Any patient who becomes pregnant, regardless of agent"],
                        answer: 1
                    },

                    // ========== MULTIPLE SCLEROSIS - Matching (3) ==========
                    {
                        type: "match",
                        q: "Match the DMT to its route + dosing frequency:",
                        pairs: [
                            { left: "Avonex", right: "IM once weekly" },
                            { left: "Plegridy", right: "SQ q2 weeks" },
                            { left: "Betaseron", right: "SQ every other day" },
                            { left: "Glatiramer acetate (Copaxone/Glatopa)", right: "SQ 20 mg daily or 40 mg three times weekly" },
                            { left: "Ofatumumab (Kesimpta)", right: "SQ weekly at weeks 0,1,2 then monthly starting week 4" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the drug to the key 'must-check/monitor' item:",
                        pairs: [
                            { left: "Interferon beta products", right: "CBC/platelets/LFT schedule and depression/suicide risk monitoring" },
                            { left: "Ofatumumab", right: "HBV screening + quantitative serum immunoglobulins" },
                            { left: "Natalizumab", right: "JCV antibody testing and close PML vigilance" },
                            { left: "Teriflunomide", right: "Pregnancy testing + TB test + LFTs/BP; washout counseling" },
                            { left: "Mitoxantrone", right: "LVEF monitoring + lifetime exposure/cardiotoxicity precautions" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the medication to the most appropriate 'when would you use it?' scenario:",
                        pairs: [
                            { left: "Ocrelizumab", right: "Only FDA-approved DMT for PPMS (also used in relapsing forms)" },
                            { left: "Alemtuzumab", right: "Reserved for patients with inadequate response to 2 MS meds" },
                            { left: "Cladribine", right: "RRMS/active SPMS (NOT CIS) and generally reserved when other therapies fail" },
                            { left: "Traditional injectables (IFNs, glatiramer)", right: "Lower efficacy/slower onset but best safety profile" },
                            { left: "Natalizumab", right: "Highly active relapsing MS; high efficacy but major PML monitoring" }
                        ]
                    },

                    // ========== MULTIPLE SCLEROSIS - Select All (2) ==========
                    {
                        type: "select",
                        q: "Select ALL vaccines listed as live vaccines (generally avoided during many MS immunomodulatory/immunosuppressive therapies):",
                        options: ["MMR", "Varicella", "Rotavirus", "FluMist (intranasal influenza)", "Yellow fever", "Injectable influenza vaccine"],
                        answer: [0, 1, 2, 3, 4]
                    },
                    {
                        type: "select",
                        q: "Select ALL statements that are TRUE regarding MS disease-modifying therapies:",
                        options: ["Many DMTs may take 12 years before effectiveness can be seen", "Steroids are used long-term to prevent disability progression", "Natalizumab has the highest PML risk among DMTs highlighted", "Teriflunomide may require a washout procedure and can persist for up to 2 years without washout", "Ocrelizumab requires premedication and post-infusion observation"],
                        answer: [0, 2, 3, 4]
                    }
                ]
            },
            "Multiple Sclerosis": {
                title: "Multiple Sclerosis DMTs & Management",
                hints: [
                    "OCRELIZUMAB = Only FDA-approved for PPMS",
                    "True relapse: 24h symptoms + 30 days since last",
                    "Steroids shorten relapse, DON'T prevent disability",
                    "Teriflunomide = Cat X, 2yr washout without procedure",
                    "Natalizumab = Highest PML risk (JCV antibody monitoring)",
                    "Ofatumumab = Anti-CD20 self-injectable (weekly x3, then monthly)",
                    "IFNs + Glatiramer = Lower efficacy but BEST safety",
                    "DMF flushing  non-enteric ASA 325mg 30min before",
                    "Fingolimod = Only S1P with pediatric indication (10yo)",
                    "Live vaccines AVOID: MMR, Varicella, Rotavirus, FluMist, Yellow fever"
                ],
                questions: [
                    // === MULTIPLE SCLEROSIS - Multiple Choice (1-15) ===
                    {
                        type: "mc",
                        q: "A 55-year-old is diagnosed with primary progressive MS (PPMS). Which DMT is specifically highlighted as the only FDA-approved agent for PPMS?",
                        options: ["Natalizumab", "Ocrelizumab", "Fingolimod", "Ofatumumab"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which scenario best meets the definition of a true MS exacerbation appropriate to consider treatment (vs pseudo-exacerbation)?",
                        options: ["Symptoms for 12 hours, last relapse 2 months ago", "Symptoms for 48 hours, last relapse 10 days ago", "Symptoms for 30 hours, last relapse 45 days ago", "Symptoms for 20 hours, last relapse 45 days ago"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "A patient has a severe relapse with functional decline. Which regimen is most consistent with the recommendation?",
                        options: ["Prednisone 10 mg daily x 5 days", "IV methylprednisolone 5001000 mg/day x 35 days", "IM methylprednisolone 40 mg once", "Dexamethasone 1 mg twice daily x 10 days"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which statement about corticosteroids for MS relapses is TRUE?",
                        options: ["Steroids prevent future relapses when used monthly", "Steroids reduce long-term disability progression when used early", "Steroids shorten relapse duration/severity but do not alter long-term disability accumulation", "Steroids should be used for relapse prevention instead of DMTs"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which DMTs are described as traditional injectables with lower efficacy/slower onset but best safety profile?",
                        options: ["Interferons and glatiramer acetate", "Natalizumab and ocrelizumab", "Fingolimod and dimethyl fumarate", "Cladribine and alemtuzumab"],
                        answer: 0
                    },
                    {
                        type: "mc",
                        q: "Which self-injectable DMT is an anti-CD20 therapy and is noted as an exception because it 'behaves like infusion therapies'?",
                        options: ["Glatiramer acetate", "Interferon beta-1a", "Ofatumumab", "Peginterferon beta-1a"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which of the following is the correct Kesimpta (ofatumumab) dosing pattern?",
                        options: ["20 mg SQ monthly starting immediately", "20 mg SQ weekly at weeks 0, 1, 2; then monthly starting week 4", "20 mg SQ daily for 14 days, then stop", "30 mcg IM weekly"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "For interferon beta products, which monitoring plan matches the recommended schedule?",
                        options: ["CBC only at baseline, then annually", "LFTs monthly indefinitely, no CBC needed", "CBC/platelets/LFTs baseline, 1 month, q3 months x 1 year, then q6 months (plus suicide risk monitoring)", "No monitoring needed unless symptoms occur"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "A patient on glatiramer acetate reports facial flushing, palpitations, chest discomfort, shortness of breath, and anxiety starting minutes after injection and resolving within ~30 minutes. Best interpretation?",
                        options: ["This is anaphylaxisadminister epinephrine immediately", "This is the benign post-injection reaction; reassure/counsel and monitor", "This indicates liver failurestop therapy", "This is PMLurgent MRI needed"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which oral DMT is explicitly noted as having a pregnancy Category X concern and may require a washout procedure?",
                        options: ["Dimethyl fumarate", "Teriflunomide", "Fingolimod", "Cladribine"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "A patient taking teriflunomide wants to become pregnant soon. What is the best counseling point?",
                        options: ["Stop teriflunomide; no further steps needed because it clears in ~1 week", "Stop teriflunomide; without washout it may take up to 2 years to reach acceptable plasma levels", "Continue teriflunomide through pregnancy because relapse risk decreases during pregnancy", "Switch to natalizumab immediately and give a live vaccine booster first"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which counseling recommendation is specifically highlighted for dimethyl fumarateassociated flushing?",
                        options: ["Take on an empty stomach to improve absorption", "Premedicate with non-enteric aspirin 325 mg 30 minutes before the dose", "Crush and sprinkle capsule contents on food", "Avoid all food with dimethyl fumarate to reduce GI upset"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Which oral DMT is the only one with a pediatric indication (10 years old) among the S1P modulators?",
                        options: ["Siponimod", "Ozanimod", "Fingolimod", "Ponesimod"],
                        answer: 2
                    },
                    {
                        type: "mc",
                        q: "Which statement best reflects the 'place in therapy' concept for natalizumab?",
                        options: ["Best first-line for all mild RRMS due to lowest risk", "Reserved for highly active disease; risk/benefit must be considered case-by-case", "Used only for PPMS", "Used only for CIS and never RRMS"],
                        answer: 1
                    },
                    {
                        type: "mc",
                        q: "Discontinuation of a DMT may be considered in which scenario?",
                        options: ["RRMS patient with no relapse for 3 months", "SPMS patient who is not ambulatory (EDSS 7) and has no ongoing relapses/MRI activity for 2 years", "Any patient who dislikes injections", "Any patient who becomes pregnant, regardless of agent"],
                        answer: 1
                    },

                    // === MULTIPLE SCLEROSIS - Matching (16-18) ===
                    {
                        type: "match",
                        q: "Match the DMT to its route + dosing frequency:",
                        pairs: [
                            { left: "Avonex", right: "IM once weekly" },
                            { left: "Plegridy", right: "SQ q2 weeks" },
                            { left: "Betaseron", right: "SQ every other day" },
                            { left: "Glatiramer acetate (Copaxone/Glatopa)", right: "SQ 20 mg daily or 40 mg three times weekly" },
                            { left: "Ofatumumab (Kesimpta)", right: "SQ weekly at weeks 0,1,2 then monthly starting week 4" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the drug to the key 'must-check/monitor' item:",
                        pairs: [
                            { left: "Interferon beta products", right: "CBC/platelets/LFT schedule and depression/suicide risk monitoring" },
                            { left: "Ofatumumab", right: "HBV screening + quantitative serum immunoglobulins" },
                            { left: "Natalizumab", right: "JCV antibody testing and close PML vigilance" },
                            { left: "Teriflunomide", right: "Pregnancy testing + TB test + LFTs/BP; washout counseling" },
                            { left: "Mitoxantrone", right: "LVEF monitoring + lifetime exposure/cardiotoxicity precautions" }
                        ]
                    },
                    {
                        type: "match",
                        q: "Match the medication to the most appropriate 'when would you use it?' scenario:",
                        pairs: [
                            { left: "Ocrelizumab", right: "Only FDA-approved DMT for PPMS (also used in relapsing forms)" },
                            { left: "Alemtuzumab", right: "Reserved for patients with inadequate response to 2 MS meds" },
                            { left: "Cladribine", right: "RRMS/active SPMS (NOT CIS) and generally reserved when other therapies fail" },
                            { left: "Traditional injectables (IFNs, glatiramer)", right: "Lower efficacy/slower onset but best safety profile" },
                            { left: "Natalizumab", right: "Highly active relapsing MS; high efficacy but major PML monitoring" }
                        ]
                    },

                    // === MULTIPLE SCLEROSIS - Select All That Apply (19-20) ===
                    {
                        type: "select",
                        q: "Select ALL vaccines listed as live vaccines (generally avoided during many MS immunomodulatory/immunosuppressive therapies):",
                        options: ["MMR", "Varicella", "Rotavirus", "FluMist (intranasal influenza)", "Yellow fever", "Injectable influenza vaccine"],
                        answer: [0, 1, 2, 3, 4]
                    },
                    {
                        type: "select",
                        q: "Select ALL statements that are TRUE regarding MS disease-modifying therapies:",
                        options: ["Many DMTs may take 12 years before effectiveness can be seen", "Steroids are used long-term to prevent disability progression", "Natalizumab has the highest PML risk among DMTs highlighted", "Teriflunomide may require a washout procedure and can persist for up to 2 years without washout", "Ocrelizumab requires premedication and post-infusion observation"],
                        answer: [0, 2, 3, 4]
                    }
                ]
            }
        };

        // Quiz State Management
        let currentQuiz = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let consecutiveWrong = 0;
        let selectedAnswers = [];
        let matchSelection = { left: null, right: null };
        let matchedPairs = {};

        // Swipe-to-reveal drag handling
        let dragState = {
            isDragging: false,
            startX: 0,
            startY: 0,
            currentX: 0,
            element: null,
            directionLocked: null,  // 'horizontal' | 'vertical' | null
            hasMoved: false
        };

        function startDrag(e, element) {
            // Prevent default only for touch to allow mouse selection elsewhere
            if (e.type === 'touchstart') {
                dragState.startX = e.touches[0].clientX;
                dragState.startY = e.touches[0].clientY;
            } else {
                dragState.startX = e.clientX;
                dragState.startY = e.clientY;
                e.preventDefault();
            }

            dragState.isDragging = true;
            dragState.element = element;
            dragState.currentX = 0;
            dragState.directionLocked = null;
            dragState.hasMoved = false;
            element.classList.add('dragging');
            element.classList.remove('released');

            // Add move and end listeners
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', onDrag, { passive: false });
            document.addEventListener('touchend', endDrag);
        }

        function onDrag(e) {
            if (!dragState.isDragging || !dragState.element) return;

            let clientX, clientY;
            if (e.type === 'touchmove') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;

                // Direction detection (only on first significant movement)
                if (!dragState.directionLocked) {
                    const deltaX = Math.abs(clientX - dragState.startX);
                    const deltaY = Math.abs(clientY - dragState.startY);
                    const threshold = 10; // pixels before locking direction

                    if (deltaX > threshold || deltaY > threshold) {
                        if (deltaX > deltaY) {
                            dragState.directionLocked = 'horizontal';
                        } else {
                            // User is scrolling vertically - abort drag
                            dragState.directionLocked = 'vertical';
                            cancelDrag();
                            return; // Let scroll happen naturally
                        }
                    } else {
                        return; // Not enough movement to determine direction
                    }
                }

                // Only preventDefault for horizontal drags
                if (dragState.directionLocked === 'horizontal') {
                    e.preventDefault();
                } else {
                    return; // Let vertical scroll pass through
                }
            } else {
                clientX = e.clientX;
            }

            // Only apply transform for horizontal drags
            if (dragState.directionLocked === 'horizontal' || e.type === 'mousemove') {
                const diff = clientX - dragState.startX;
                // Only allow dragging left (negative values)
                dragState.currentX = Math.min(0, Math.max(diff, -200));
                dragState.element.style.transform = `translateX(${dragState.currentX}px)`;
                dragState.hasMoved = true;
            }
        }

        function cancelDrag() {
            if (!dragState.element) return;

            const element = dragState.element;
            element.classList.remove('dragging');
            element.style.transform = 'translateX(0)';

            dragState.isDragging = false;
            dragState.element = null;
            dragState.directionLocked = null;

            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', onDrag);
            document.removeEventListener('touchend', endDrag);
        }

        function endDrag(e) {
            if (!dragState.isDragging || !dragState.element) return;

            const element = dragState.element;
            element.classList.remove('dragging');
            element.classList.add('released');

            // Only trigger quiz if user actually dragged horizontally past threshold
            if (dragState.directionLocked === 'horizontal' && dragState.currentX < -120) {
                const examName = element.querySelector('.exam-name').textContent;
                // Animate fully off before opening quiz
                element.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    openCookedQuiz(examName);
                    // Reset after quiz opens
                    setTimeout(() => {
                        element.style.transform = 'translateX(0)';
                    }, 300);
                }, 200);
            } else {
                // Snap back
                element.style.transform = 'translateX(0)';
            }

            // Clean up
            dragState.isDragging = false;
            dragState.element = null;
            dragState.directionLocked = null;
            dragState.hasMoved = false;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', onDrag);
            document.removeEventListener('touchend', endDrag);
        }

        function openCookedQuiz(examTopic) {
            const bank = examQuestionBanks[examTopic];
            if (!bank || bank.questions.length === 0 || (bank.questions.length === 1 && bank.questions[0].options[0] === "Check back later")) {
                alert(` Quiz for "${examTopic}" coming soon!\n\nCheck back later for practice questions.`);
                return;
            }

            // Random selection of 10 questions (or all if < 10)
            const shuffled = [...bank.questions].sort(() => Math.random() - 0.5);
            currentQuestions = shuffled.slice(0, Math.min(10, shuffled.length));

            currentQuiz = bank;
            currentQuestionIndex = 0;
            quizScore = 0;
            consecutiveWrong = 0;

            document.getElementById('quiz-modal').classList.add('show');
            document.getElementById('quiz-title').textContent = ` Am I Cooked? - ${bank.title}`;
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (!currentQuiz || currentQuestionIndex >= currentQuestions.length) return;

            const q = currentQuestions[currentQuestionIndex];
            const total = currentQuestions.length;
            const typeLabels = { mc: "Multiple Choice", select: "Select All", match: "Matching" };

            let html = `
                <div class="quiz-progress">${currentQuestionIndex + 1} / ${total}</div>
                <span class="quiz-type-badge ${q.type}">${typeLabels[q.type] || "Question"}</span>
                <div class="quiz-question">${q.q}</div>
            `;

            if (q.type === "mc") {
                html += renderMultipleChoice(q);
            } else if (q.type === "select") {
                html += renderSelectAll(q);
            } else if (q.type === "match") {
                html += renderMatching(q);
            }

            document.getElementById('quiz-content').innerHTML = html;
        }

        // === MULTIPLE CHOICE ===
        function renderMultipleChoice(q) {
            const indexed = q.options.map((opt, i) => ({ text: opt, originalIndex: i }));
            indexed.sort(() => Math.random() - 0.5);
            currentQuestions[currentQuestionIndex].shuffledOptions = indexed;

            let html = '<div class="quiz-options">';
            indexed.forEach((opt, i) => {
                html += `<button class="quiz-option" onclick="selectMCAnswer(${i})">${opt.text}</button>`;
            });
            html += '</div>';
            return html;
        }

        function selectMCAnswer(index) {
            const q = currentQuestions[currentQuestionIndex];
            const shuffled = q.shuffledOptions;
            const buttons = document.querySelectorAll('.quiz-option');
            const selectedOriginal = shuffled[index].originalIndex;
            const isCorrect = selectedOriginal === q.answer;

            buttons.forEach((btn, i) => {
                btn.disabled = true;
                const origIndex = shuffled[i].originalIndex;
                if (origIndex === q.answer) btn.classList.add('correct');
                else if (i === index) btn.classList.add('wrong');
            });

            handleAnswerResult(isCorrect);
        }

        // === SELECT ALL THAT APPLY ===
        function renderSelectAll(q) {
            selectedAnswers = [];
            const indexed = q.options.map((opt, i) => ({ text: opt, originalIndex: i }));
            indexed.sort(() => Math.random() - 0.5);
            currentQuestions[currentQuestionIndex].shuffledOptions = indexed;

            let html = '<div class="quiz-options quiz-select-all">';
            indexed.forEach((opt, i) => {
                html += `
                    <button class="quiz-option quiz-checkbox" onclick="toggleSelectAnswer(${i}, this)">
                        <span class="checkbox-icon"></span>
                        <span class="checkbox-text">${opt.text}</span>
                    </button>`;
            });
            html += '</div>';
            html += '<button class="quiz-submit-btn" onclick="submitSelectAll()">Submit Answer</button>';
            return html;
        }

        function toggleSelectAnswer(index, btn) {
            btn.classList.toggle('selected');
            const icon = btn.querySelector('.checkbox-icon');
            if (btn.classList.contains('selected')) {
                icon.textContent = '';
                if (!selectedAnswers.includes(index)) selectedAnswers.push(index);
            } else {
                icon.textContent = '';
                selectedAnswers = selectedAnswers.filter(i => i !== index);
            }
        }

        function submitSelectAll() {
            const q = currentQuestions[currentQuestionIndex];
            const shuffled = q.shuffledOptions;
            const buttons = document.querySelectorAll('.quiz-option');
            const submitBtn = document.querySelector('.quiz-submit-btn');
            submitBtn.disabled = true;

            // Map selected indices to original indices
            const selectedOriginal = selectedAnswers.map(i => shuffled[i].originalIndex).sort();
            const correctOriginal = [...q.answer].sort();

            // Check if arrays match
            const isCorrect = selectedOriginal.length === correctOriginal.length &&
                selectedOriginal.every((val, i) => val === correctOriginal[i]);

            // Show feedback
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                const origIndex = shuffled[i].originalIndex;
                const shouldBeSelected = q.answer.includes(origIndex);
                const wasSelected = selectedAnswers.includes(i);

                if (shouldBeSelected && wasSelected) btn.classList.add('correct');
                else if (shouldBeSelected && !wasSelected) btn.classList.add('correct'); // missed
                else if (!shouldBeSelected && wasSelected) btn.classList.add('wrong');
            });

            handleAnswerResult(isCorrect);
        }

        // === MATCHING ===
        function renderMatching(q) {
            matchedPairs = {};
            matchSelection = { left: null, right: null };

            const leftItems = q.pairs.map((p, i) => ({ text: p.left, index: i }));
            const rightItems = q.pairs.map((p, i) => ({ text: p.right, index: i }));
            rightItems.sort(() => Math.random() - 0.5);
            currentQuestions[currentQuestionIndex].shuffledRight = rightItems;

            let html = `
                <div class="match-container">
                    <div class="match-column match-left">
                        ${leftItems.map((item, i) => `
                            <div class="match-item" data-left="${i}" onclick="selectMatchItem(this, 'left', ${i})">
                                <span class="match-number">${i + 1}.</span>
                                <span class="match-text">${item.text}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="match-column match-right">
                        ${rightItems.map((item, displayIndex) => `
                            <div class="match-item" data-right="${item.index}" onclick="selectMatchItem(this, 'right', ${item.index})">
                                <span class="match-letter">${String.fromCharCode(65 + displayIndex)}.</span>
                                <span class="match-text">${item.text}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="match-pairs" id="match-pairs">Click a term, then click its match</div>
                <button class="quiz-submit-btn" onclick="submitMatching()" id="match-submit-btn" disabled>Submit Answer</button>
            `;
            return html;
        }

        function selectMatchItem(el, side, index) {
            if (el.classList.contains('paired')) return;

            // Remove active from same column
            document.querySelectorAll(`.match-${side} .match-item`).forEach(item => {
                item.classList.remove('active');
            });

            el.classList.add('active');
            matchSelection[side] = { element: el, index: index };

            // If both selected, create pair
            if (matchSelection.left && matchSelection.right) {
                const leftIdx = matchSelection.left.index;
                const rightIdx = matchSelection.right.index;

                matchedPairs[leftIdx] = rightIdx;

                matchSelection.left.element.classList.remove('active');
                matchSelection.left.element.classList.add('paired');
                matchSelection.right.element.classList.remove('active');
                matchSelection.right.element.classList.add('paired');

                updateMatchPairsDisplay();

                matchSelection = { left: null, right: null };

                // Enable submit if all pairs made
                const q = currentQuestions[currentQuestionIndex];
                if (Object.keys(matchedPairs).length === q.pairs.length) {
                    document.getElementById('match-submit-btn').disabled = false;
                }
            }
        }

        function updateMatchPairsDisplay() {
            const q = currentQuestions[currentQuestionIndex];
            const pairsDiv = document.getElementById('match-pairs');

            if (Object.keys(matchedPairs).length === 0) {
                pairsDiv.innerHTML = 'Click a term, then click its match';
                return;
            }

            let html = '<strong>Your pairs:</strong>';
            for (const [leftIdx, rightIdx] of Object.entries(matchedPairs)) {
                const leftText = q.pairs[leftIdx].left;
                const rightItem = q.pairs.find((p, i) => i === parseInt(rightIdx));
                html += `<div class="match-pair-item">
                    <span>${parseInt(leftIdx) + 1}. ${leftText}  ${rightItem ? rightItem.right : '?'}</span>
                    <span class="match-pair-remove" onclick="removeMatchPair(${leftIdx})"></span>
                </div>`;
            }
            pairsDiv.innerHTML = html;
        }

        function removeMatchPair(leftIdx) {
            const rightIdx = matchedPairs[leftIdx];
            delete matchedPairs[leftIdx];

            // Unpair the elements
            document.querySelector(`.match-item[data-left="${leftIdx}"]`).classList.remove('paired');
            document.querySelector(`.match-item[data-right="${rightIdx}"]`).classList.remove('paired');

            updateMatchPairsDisplay();
            document.getElementById('match-submit-btn').disabled = true;
        }

        function submitMatching() {
            const q = currentQuestions[currentQuestionIndex];
            const submitBtn = document.getElementById('match-submit-btn');
            submitBtn.disabled = true;

            // Check correctness: left index should match right index (pairs are 1:1)
            let correctCount = 0;
            for (const [leftIdx, rightIdx] of Object.entries(matchedPairs)) {
                if (parseInt(leftIdx) === parseInt(rightIdx)) correctCount++;
            }

            const isCorrect = correctCount === q.pairs.length;

            // Show feedback in pairs display
            const pairsDiv = document.getElementById('match-pairs');
            let html = '<strong>Results:</strong>';
            for (const [leftIdx, rightIdx] of Object.entries(matchedPairs)) {
                const leftText = q.pairs[leftIdx].left;
                const rightItem = q.pairs.find((p, i) => i === parseInt(rightIdx));
                const correct = parseInt(leftIdx) === parseInt(rightIdx);
                html += `<div class="match-pair-item" style="color: ${correct ? '#22C55E' : '#EF4444'}">
                    <span>${correct ? '' : ''} ${leftText}  ${rightItem.right}</span>
                </div>`;
            }
            pairsDiv.innerHTML = html;

            // Disable all match items
            document.querySelectorAll('.match-item').forEach(el => {
                el.style.pointerEvents = 'none';
            });

            handleAnswerResult(isCorrect);
        }

        // === HINT SYSTEM ===
        function showHint() {
            const hints = currentQuiz.hints || ["Keep studying! You've got this!"];
            const randomHint = hints[Math.floor(Math.random() * hints.length)];

            document.getElementById('quiz-content').innerHTML = `
                <div class="quiz-hint">
                    <div class="hint-icon"></div>
                    <div class="hint-title">High-Yield Tip!</div>
                    <div class="hint-text">${randomHint}</div>
                    <button class="hint-continue-btn" onclick="continueAfterHint()">Continue</button>
                </div>
            `;
        }

        function continueAfterHint() {
            advanceQuestion();
        }

        function handleAnswerResult(isCorrect) {
            if (isCorrect) {
                quizScore++;
                consecutiveWrong = 0;
            } else {
                consecutiveWrong++;
            }

            // Show Next button instead of auto-advancing
            setTimeout(() => {
                showNextButton(isCorrect);
            }, 400);
        }

        function showNextButton(wasCorrect) {
            const quizContent = document.getElementById('quiz-content');
            const isLastQuestion = currentQuestionIndex >= currentQuestions.length - 1;
            const buttonText = isLastQuestion ? 'See Results' : 'Next Question ';

            // Create feedback banner and next button
            const feedbackHtml = `
                <div class="quiz-feedback ${wasCorrect ? 'correct' : 'wrong'}">
                    ${wasCorrect ? ' Correct!' : ' Incorrect - Review the correct answer above'}
                </div>
                <button class="quiz-next-btn" onclick="handleNextClick()">${buttonText}</button>
            `;

            // Append to quiz content
            quizContent.insertAdjacentHTML('beforeend', feedbackHtml);
        }

        function handleNextClick() {
            if (consecutiveWrong >= 3) {
                consecutiveWrong = 0;
                showHint();
            } else {
                advanceQuestion();
            }
        }

        function advanceQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                showQuizQuestion();
            } else {
                showQuizResult();
            }
        }

        function showQuizResult() {
            const total = currentQuestions.length;
            const percent = Math.round((quizScore / total) * 100);
            let verdict, emoji;

            if (percent >= 90) { verdict = "NOT COOKED!"; emoji = ""; }
            else if (percent >= 70) { verdict = "Slightly warm"; emoji = ""; }
            else if (percent >= 50) { verdict = "Medium rare"; emoji = ""; }
            else { verdict = "FULLY COOKED"; emoji = ""; }

            document.getElementById('quiz-content').innerHTML = `
                <div class="quiz-result">
                    <div class="result-emoji">${emoji}</div>
                    <div class="result-score">${quizScore} / ${total}</div>
                    <div class="result-verdict">${verdict}</div>
                    <button class="quiz-close-btn" onclick="closeQuizModal()">Try Again</button>
                </div>
            `;
        }

        function closeQuizModal() {
            document.getElementById('quiz-modal').classList.remove('show');
            currentQuiz = null;
            currentQuestions = [];
            matchedPairs = {};
            selectedAnswers = [];
        }

        function init() {
            getDailyQuote();
            generateCalendar();
            updateStatus();
            updateClock();
            updateFinalCountdown();
            setTimeout(scrollToNow, 300);
        }

        init();
        setInterval(() => { updateClock(); updateStatus(); updateLivePosition(); }, 1000);
    </script>
</body>
</html>
